<!DOCTYPE html>
<html lang="fr-FR">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>Reverse - Clé enchantée | Jeanne d&#39;Hack CTF</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="description" content="Le but de ce challenge n&rsquo;est pas de trouver un mot de passe mais de générer un fichier
avec le nom correct pour que le programme vienne écrire le flag dedans. Le but n&rsquo;est pas
de reverser la fonction write_flag. Le binaire est strippé pour rendre encore plus difficile
la compréhension de cette fonction. A l&rsquo;inverse, un SRE comme Ghidra identifiera les appels
aux fonctions importées de la libc et les affichera correctement, même stripper.">
    <meta name="generator" content="Hugo 0.152.2">
    
    
    
      <meta name="robots" content="index, follow">
    
    

    
<link rel="stylesheet" href="/ananke/css/main.min.efe4d852f731d5d1fbb87718387202a97aafd768cdcdaed0662bbe6982e91824.css" >



  
    <link rel="stylesheet" href="/css/shrink.css">
  

  
    <link rel="stylesheet" href="/css/dropdown.css">
  

  
    <link rel="stylesheet" href="/css/carousel.css">
  


    
<script src="/js/shrink.js"></script>
<script src="/js/slideshow.js"></script>
<script src="/js/toggleMap.js"></script>

    
      

    

    

    
      <link rel="canonical" href="https://jeanned-hack-ctf.github.io/writeups/2024/reverse/keygen/">
    

    <meta property="og:url" content="https://jeanned-hack-ctf.github.io/writeups/2024/reverse/keygen/">
  <meta property="og:site_name" content="Jeanne d&#39;Hack CTF">
  <meta property="og:title" content="Reverse - Clé enchantée">
  <meta property="og:description" content="Le but de ce challenge n’est pas de trouver un mot de passe mais de générer un fichier avec le nom correct pour que le programme vienne écrire le flag dedans. Le but n’est pas de reverser la fonction write_flag. Le binaire est strippé pour rendre encore plus difficile la compréhension de cette fonction. A l’inverse, un SRE comme Ghidra identifiera les appels aux fonctions importées de la libc et les affichera correctement, même stripper.">
  <meta property="og:locale" content="fr_FR">
  <meta property="og:type" content="article">
    <meta property="article:section" content="writeups">

  <meta itemprop="name" content="Reverse - Clé enchantée">
  <meta itemprop="description" content="Le but de ce challenge n’est pas de trouver un mot de passe mais de générer un fichier avec le nom correct pour que le programme vienne écrire le flag dedans. Le but n’est pas de reverser la fonction write_flag. Le binaire est strippé pour rendre encore plus difficile la compréhension de cette fonction. A l’inverse, un SRE comme Ghidra identifiera les appels aux fonctions importées de la libc et les affichera correctement, même stripper.">
  <meta itemprop="wordCount" content="1457">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Reverse - Clé enchantée">
  <meta name="twitter:description" content="Le but de ce challenge n’est pas de trouver un mot de passe mais de générer un fichier avec le nom correct pour que le programme vienne écrire le flag dedans. Le but n’est pas de reverser la fonction write_flag. Le binaire est strippé pour rendre encore plus difficile la compréhension de cette fonction. A l’inverse, un SRE comme Ghidra identifiera les appels aux fonctions importées de la libc et les affichera correctement, même stripper.">

      
    
	<script type="text/javascript">
    
    if (window.location.protocol !== 'https:' && window.location.hostname !== 'localhost') {
        window.location.href = 'https://' + window.location.host + window.location.pathname + window.location.search;
    }
</script>



    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
<script>
  MathJax = {
    tex: {
      displayMath: [['$$', '$$'], ['\\[', '\\]']],
      inlineMath: [['$', '$'], ['\\(', '\\)']]
    },
    loader:{
      load: ['ui/safe']
    },
  };
</script>


  </head><body class="ma0 avenir bg-near-white tj production">

    
   
  

  
  
  
  <header class="contain bg-center bg-black-90" style="background-image: url('https://jeanned-hack-ctf.github.io/images/2026/PERSO-ENTIER2026-NOIR-BLANC.png');">
    <div class="bg-black-00">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l center items-center justify-between">
    <a href="/" class="f3 fw2 hover-white white-90 dib no-underline">
      
        <img src="/images/2026/LOGO-BLANC.png" class="w100 mw5-ns" alt="Jeanne d&#39;Hack CTF" />
      
    </a>
    <div class="flex-l items-center">
      

      
        <ul class="pl0 mr3">
          
            <li class="list f5 f4-ns fw4 dib  pr3">
              <a class="hover-white white-90 no-underline" href="/inscriptions/" title="Inscriptions page">
                Inscriptions
              </a>
              
            </li>
          
            <li class="list f5 f4-ns fw4 dib has-dropdown pr3">
              <a class="hover-white white-90 no-underline" href="/writeups/" title="Write-Ups page">
                Write-Ups
              </a>
              
                <ul class="dropdown">
                  
                    <li>
                      <a class="hover-white white-90 no-underline" href="/writeups/2024/">
                        Write-ups 2024
                      </a>
                    </li>
                  
                    <li>
                      <a class="hover-white white-90 no-underline" href="/writeups/2025/">
                        Write-ups 2025
                      </a>
                    </li>
                  
                    <li>
                      <a class="hover-white white-90 no-underline" href="/writeups/2026/">
                        Write-ups 2026
                      </a>
                    </li>
                  
                </ul>
              
            </li>
          
            <li class="list f5 f4-ns fw4 dib has-dropdown pr3">
              <a class="hover-white white-90 no-underline" href="/post/" title="Éditions précedentes page">
                Éditions précedentes
              </a>
              
                <ul class="dropdown">
                  
                    <li>
                      <a class="hover-white white-90 no-underline" href="/post/2024/">
                        Edition 2024
                      </a>
                    </li>
                  
                    <li>
                      <a class="hover-white white-90 no-underline" href="/post/2025/">
                        Edition 2025
                      </a>
                    </li>
                  
                </ul>
              
            </li>
          
        </ul>
      
      <div class="ananke-socials"><a href="https://www.instagram.com/jeannedhackctf/" target="_blank" rel="noopener"
        class="ananke-social-link link-transition instagram link dib z-999 pt3 pt0-l mr1"
        title="follow on Instagram - Opens in a new window"
        aria-label="follow on Instagram - Opens in a new window">
      <span class="icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc. --><path d="M224.1 141c-63.6 0-114.9 51.3-114.9 114.9s51.3 114.9 114.9 114.9S339 319.5 339 255.9 287.7 141 224.1 141zm0 189.6c-41.1 0-74.7-33.5-74.7-74.7s33.5-74.7 74.7-74.7 74.7 33.5 74.7 74.7-33.6 74.7-74.7 74.7zm146.4-194.3c0 14.9-12 26.8-26.8 26.8-14.9 0-26.8-12-26.8-26.8s12-26.8 26.8-26.8 26.8 12 26.8 26.8zm76.1 27.2c-1.7-35.9-9.9-67.7-36.2-93.9-26.2-26.2-58-34.4-93.9-36.2-37-2.1-147.9-2.1-184.9 0-35.8 1.7-67.6 9.9-93.9 36.1s-34.4 58-36.2 93.9c-2.1 37-2.1 147.9 0 184.9 1.7 35.9 9.9 67.7 36.2 93.9s58 34.4 93.9 36.2c37 2.1 147.9 2.1 184.9 0 35.9-1.7 67.7-9.9 93.9-36.2 26.2-26.2 34.4-58 36.2-93.9 2.1-37 2.1-147.8 0-184.8zM398.8 388c-7.8 19.6-22.9 34.7-42.6 42.6-29.5 11.7-99.5 9-132.1 9s-102.7 2.6-132.1-9c-19.6-7.8-34.7-22.9-42.6-42.6-11.7-29.5-9-99.5-9-132.1s-2.6-102.7 9-132.1c7.8-19.6 22.9-34.7 42.6-42.6 29.5-11.7 99.5-9 132.1-9s102.7-2.6 132.1 9c19.6 7.8 34.7 22.9 42.6 42.6 11.7 29.5 9 99.5 9 132.1s2.7 102.7-9 132.1z"/></svg>
            
          </span></a><a href="http://linkedin.com/company/jeanne-d-hack-ctf" target="_blank" rel="noopener"
        class="ananke-social-link link-transition linkedin link dib z-999 pt3 pt0-l mr1"
        title="follow on LinkedIn - Opens in a new window"
        aria-label="follow on LinkedIn - Opens in a new window">
      <span class="icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc. --><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>
            
          </span></a><a href="https://discord.gg/nbqQEe7qXB" target="_blank" rel="noopener"
        class="ananke-social-link link-transition discord link dib z-999 pt3 pt0-l mr1"
        title="follow on Discord - Opens in a new window"
        aria-label="follow on Discord - Opens in a new window">
      <span class="icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc. --><path d="M524.531,69.836a1.5,1.5,0,0,0-.764-.7A485.065,485.065,0,0,0,404.081,32.03a1.816,1.816,0,0,0-1.923.91,337.461,337.461,0,0,0-14.9,30.6,447.848,447.848,0,0,0-134.426,0,309.541,309.541,0,0,0-15.135-30.6,1.89,1.89,0,0,0-1.924-.91A483.689,483.689,0,0,0,116.085,69.137a1.712,1.712,0,0,0-.788.676C39.068,183.651,18.186,294.69,28.43,404.354a2.016,2.016,0,0,0,.765,1.375A487.666,487.666,0,0,0,176.02,479.918a1.9,1.9,0,0,0,2.063-.676A348.2,348.2,0,0,0,208.12,430.4a1.86,1.86,0,0,0-1.019-2.588,321.173,321.173,0,0,1-45.868-21.853,1.885,1.885,0,0,1-.185-3.126c3.082-2.309,6.166-4.711,9.109-7.137a1.819,1.819,0,0,1,1.9-.256c96.229,43.917,200.41,43.917,295.5,0a1.812,1.812,0,0,1,1.924.233c2.944,2.426,6.027,4.851,9.132,7.16a1.884,1.884,0,0,1-.162,3.126,301.407,301.407,0,0,1-45.89,21.83,1.875,1.875,0,0,0-1,2.611,391.055,391.055,0,0,0,30.014,48.815,1.864,1.864,0,0,0,2.063.7A486.048,486.048,0,0,0,610.7,405.729a1.882,1.882,0,0,0,.765-1.352C623.729,277.594,590.933,167.465,524.531,69.836ZM222.491,337.58c-28.972,0-52.844-26.587-52.844-59.239S193.056,219.1,222.491,219.1c29.665,0,53.306,26.82,52.843,59.239C275.334,310.993,251.924,337.58,222.491,337.58Zm195.38,0c-28.971,0-52.843-26.587-52.843-59.239S388.437,219.1,417.871,219.1c29.667,0,53.307,26.82,52.844,59.239C470.715,310.993,447.538,337.58,417.871,337.58Z"/></svg>
            
          </span></a><a href="https://github.com/JeanneD-Hack-CTF/" target="_blank" rel="noopener"
        class="ananke-social-link link-transition github link dib z-999 pt3 pt0-l mr1"
        title="follow on GitHub - Opens in a new window"
        aria-label="follow on GitHub - Opens in a new window">
      <span class="icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc. --><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
            
          </span></a></div>

    </div>
  </div>
</nav>

    </div>
  </header>



    <main class="pb7" role="main">
      
  
  
  <article class="flex-l mw8 center ph3 flex-wrap justify-between">
    <header class="mt4 w-100">
      <aside class="instapaper_ignoref b helvetica tracked ttu">
          
        Write-ups 2024
      </aside><div id="sharing" class="mt3 ananke-socials"></div>
<h1 class="f1 avenir mt3 mb1">Reverse - Clé enchantée</h1>
      
      
      

      
      
    </header>
    <div class="nested-copy-line-height lh-copy avenir bg-near-white tj w-100 f4 nested-links mid-gray pr4-l"><div class="bg-light-gray pa3 nested-copy-line-height nested-links">
          <p class="f5 b mt0">Table des matières</p>
          <nav id="TableOfContents">
  <ul>
    <li><a href="#solution-i---statique">Solution I - Statique</a></li>
    <li><a href="#solution-ii---dynamique">Solution II - Dynamique</a></li>
  </ul>
</nav>
        </div><p>Le but de ce challenge n&rsquo;est pas de trouver un mot de passe mais de générer un fichier
avec le nom correct pour que le programme vienne écrire le flag dedans. Le but n&rsquo;est pas
de reverser la fonction <code>write_flag</code>. Le binaire est strippé pour rendre encore plus difficile
la compréhension de cette fonction. A l&rsquo;inverse, un SRE comme Ghidra identifiera les appels
aux fonctions importées de la libc et les affichera correctement, même stripper.</p>
<h2 id="solution-i---statique">Solution I - Statique</h2>
<p>Comme le binaire ne contient pas de symboles qui lui sont propres, Ghidra n&rsquo;est pas en mesure
de trouver la fonction <code>main</code>, c&rsquo;est pourquoi il affiche le réel point d&rsquo;entrée du programme:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C" data-lang="C"><span style="display:flex;"><span><span style="color:#66d9ef">void</span> processEntry <span style="color:#a6e22e">entry</span>(undefined8 param_1,undefined8 param_2)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  undefined auStack_8 [<span style="color:#ae81ff">8</span>];
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">__libc_start_main</span>(FUN_001015cc,param_2,<span style="color:#f92672">&amp;</span>stack0x00000008,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>,param_1,auStack_8);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">do</span> {
</span></span><span style="display:flex;"><span>                    <span style="color:#75715e">/* WARNING: Do nothing block with infinite loop */</span>
</span></span><span style="display:flex;"><span>  } <span style="color:#66d9ef">while</span>( true );
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Cette fonction permet d&rsquo;initialiser la libc puis d&rsquo;appeler la fonction <code>main</code>. Cette
dernière étant passée comme premier argument de la fonction <code>__libc_start_main</code>. On
peut donc déduire (et renommer) que <code>FUN_001015cc</code> est <code>main</code>.  Maintenant si
on examine le code de <code>main</code> on obtient le pseudo-code suivant:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C" data-lang="C"><span style="display:flex;"><span>undefined8 <span style="color:#a6e22e">main</span>(<span style="color:#66d9ef">int</span> argc,<span style="color:#66d9ef">char</span> <span style="color:#f92672">**</span>argv)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">int</span> iVar1;
</span></span><span style="display:flex;"><span>  undefined8 uVar2;
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (argc <span style="color:#f92672">==</span> <span style="color:#ae81ff">2</span>) {
</span></span><span style="display:flex;"><span>    iVar1 <span style="color:#f92672">=</span> <span style="color:#a6e22e">FUN_00101479</span>(argv[<span style="color:#ae81ff">1</span>]);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (iVar1 <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>) {
</span></span><span style="display:flex;"><span>      uVar2 <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">puts</span>(<span style="color:#e6db74">&#34;Wrong password&#34;</span>);
</span></span><span style="display:flex;"><span>      uVar2 <span style="color:#f92672">=</span> <span style="color:#ae81ff">0xffffffd6</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">printf</span>(<span style="color:#e6db74">&#34;Usage: %s &lt;password&gt;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>,<span style="color:#f92672">*</span>argv);
</span></span><span style="display:flex;"><span>    uVar2 <span style="color:#f92672">=</span> <span style="color:#ae81ff">0xffffffd6</span>;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> uVar2;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>On peut voir que le programme appelle la fonction <code>FUN_00101479</code> sur l&rsquo;entrée utilisateur et si
cette fonction renvoie une valeur différente de 0, le programme affiche <code>Wrong password</code>. On
peut en déduire que la fonction vérifie le mot de passe, on la renomme donc en <code>checkPassword</code>.
Cette fonction contient le code suivant:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C" data-lang="C"><span style="display:flex;"><span>undefined8 <span style="color:#a6e22e">checkPassword</span>(<span style="color:#66d9ef">void</span>)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">int</span> iVar1;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">time_t</span> tVar2;
</span></span><span style="display:flex;"><span>  ulong uVar3;
</span></span><span style="display:flex;"><span>  undefined8 uVar4;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">long</span> in_FS_OFFSET;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">int</span> local_88;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">char</span> local_78 [<span style="color:#ae81ff">32</span>];
</span></span><span style="display:flex;"><span>  ulong local_58;
</span></span><span style="display:flex;"><span>  undefined8 local_50;
</span></span><span style="display:flex;"><span>  undefined8 local_48;
</span></span><span style="display:flex;"><span>  undefined8 local_40;
</span></span><span style="display:flex;"><span>  undefined8 local_38;
</span></span><span style="display:flex;"><span>  undefined6 local_30;
</span></span><span style="display:flex;"><span>  undefined2 uStack_2a;
</span></span><span style="display:flex;"><span>  undefined6 uStack_28;
</span></span><span style="display:flex;"><span>  undefined8 local_22;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">long</span> local_10;
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  local_10 <span style="color:#f92672">=</span> <span style="color:#f92672">*</span>(<span style="color:#66d9ef">long</span> <span style="color:#f92672">*</span>)(in_FS_OFFSET <span style="color:#f92672">+</span> <span style="color:#ae81ff">0x28</span>);
</span></span><span style="display:flex;"><span>  local_58 <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x4c71764678506d62</span>;
</span></span><span style="display:flex;"><span>  local_50 <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x4737524d58493575</span>;
</span></span><span style="display:flex;"><span>  local_48 <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x48327770736b3634</span>;
</span></span><span style="display:flex;"><span>  local_40 <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x556368694f72667a</span>;
</span></span><span style="display:flex;"><span>  local_38 <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x3830643145564e6f</span>;
</span></span><span style="display:flex;"><span>  local_30 <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x5a4353446e6c</span>;
</span></span><span style="display:flex;"><span>  uStack_2a <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x6133</span>;
</span></span><span style="display:flex;"><span>  uStack_28 <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x514257794a54</span>;
</span></span><span style="display:flex;"><span>  local_22 <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x41744b596a656739</span>;
</span></span><span style="display:flex;"><span>  tVar2 <span style="color:#f92672">=</span> <span style="color:#a6e22e">time</span>((<span style="color:#66d9ef">time_t</span> <span style="color:#f92672">*</span>)<span style="color:#ae81ff">0x0</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">srandom</span>((uint)tVar2);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">for</span> (local_88 <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; local_88 <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0x20</span>; local_88 <span style="color:#f92672">=</span> local_88 <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>) {
</span></span><span style="display:flex;"><span>    uVar3 <span style="color:#f92672">=</span> <span style="color:#a6e22e">random</span>();
</span></span><span style="display:flex;"><span>    local_78[local_88] <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>         <span style="color:#f92672">*</span>(<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>)((<span style="color:#66d9ef">long</span>)<span style="color:#f92672">&amp;</span>local_58 <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>                  (<span style="color:#66d9ef">long</span>)((<span style="color:#66d9ef">int</span>)uVar3 <span style="color:#f92672">+</span> ((<span style="color:#66d9ef">int</span>)(uVar3 <span style="color:#f92672">/</span> <span style="color:#ae81ff">0x3e</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">5</span>) <span style="color:#f92672">-</span> (<span style="color:#66d9ef">int</span>)(uVar3 <span style="color:#f92672">/</span> <span style="color:#ae81ff">0x3e</span>)) <span style="color:#f92672">*</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>));
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  local_58 <span style="color:#f92672">=</span> local_58 <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xffffffffffffff00</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">sleep</span>(<span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>  iVar1 <span style="color:#f92672">=</span> <span style="color:#a6e22e">access</span>(local_78,<span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (iVar1 <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>) {
</span></span><span style="display:flex;"><span>    uVar4 <span style="color:#f92672">=</span> <span style="color:#a6e22e">FUN_001011d9</span>(local_78);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>    uVar4 <span style="color:#f92672">=</span> <span style="color:#ae81ff">0xffffffd6</span>;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (local_10 <span style="color:#f92672">!=</span> <span style="color:#f92672">*</span>(<span style="color:#66d9ef">long</span> <span style="color:#f92672">*</span>)(in_FS_OFFSET <span style="color:#f92672">+</span> <span style="color:#ae81ff">0x28</span>)) {
</span></span><span style="display:flex;"><span>                    <span style="color:#75715e">/* WARNING: Subroutine does not return */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">__stack_chk_fail</span>();
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> uVar4;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>La première chose que l&rsquo;on peut remarquer est que Ghidra a typé la fonction
comme <code>int (*)(void)</code> ce qui laisse à penser que le paramètre fournit par l&rsquo;utilisateur
sur la ligne de commande n&rsquo;est en réalité pas utilisé.</p>
<p>Ensuite on peut voir une série de variables initialiser avec des valeurs entières très
grande:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C" data-lang="C"><span style="display:flex;"><span>local_58 <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x4c71764678506d62</span>;
</span></span><span style="display:flex;"><span>local_50 <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x4737524d58493575</span>;
</span></span><span style="display:flex;"><span>local_48 <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x48327770736b3634</span>;
</span></span><span style="display:flex;"><span>local_40 <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x556368694f72667a</span>;
</span></span><span style="display:flex;"><span>local_38 <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x3830643145564e6f</span>;
</span></span><span style="display:flex;"><span>local_30 <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x5a4353446e6c</span>;
</span></span><span style="display:flex;"><span>uStack_2a <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x6133</span>;
</span></span><span style="display:flex;"><span>uStack_28 <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x514257794a54</span>;
</span></span><span style="display:flex;"><span>local_22 <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x41744b596a656739</span>;
</span></span></code></pre></div><p>Ce type de motif correspond en réalité à un tableau, une deuxième indication est le fait
que, pris un par un, les bytes sont tous des caractères affichables. Si on retype nos
variables en un unique tableau de caractères, on obtient ceci:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C" data-lang="C"><span style="display:flex;"><span>  array[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;b&#39;</span>;
</span></span><span style="display:flex;"><span>  array[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;m&#39;</span>;
</span></span><span style="display:flex;"><span>  array[<span style="color:#ae81ff">2</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;P&#39;</span>;
</span></span><span style="display:flex;"><span>  array[<span style="color:#ae81ff">3</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;x&#39;</span>;
</span></span><span style="display:flex;"><span>  array[<span style="color:#ae81ff">4</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;F&#39;</span>;
</span></span><span style="display:flex;"><span>  array[<span style="color:#ae81ff">5</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;v&#39;</span>;
</span></span><span style="display:flex;"><span>  array[<span style="color:#ae81ff">6</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;q&#39;</span>;
</span></span><span style="display:flex;"><span>  array[<span style="color:#ae81ff">7</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;L&#39;</span>;
</span></span><span style="display:flex;"><span>  array[<span style="color:#ae81ff">8</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;u&#39;</span>;
</span></span><span style="display:flex;"><span>  array[<span style="color:#ae81ff">9</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;5&#39;</span>;
</span></span><span style="display:flex;"><span>  array[<span style="color:#ae81ff">10</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;I&#39;</span>;
</span></span><span style="display:flex;"><span>  array[<span style="color:#ae81ff">11</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;X&#39;</span>;
</span></span><span style="display:flex;"><span>  array[<span style="color:#ae81ff">12</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;M&#39;</span>;
</span></span><span style="display:flex;"><span>  array[<span style="color:#ae81ff">13</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;R&#39;</span>;
</span></span><span style="display:flex;"><span>  array[<span style="color:#ae81ff">14</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;7&#39;</span>;
</span></span><span style="display:flex;"><span>  array[<span style="color:#ae81ff">15</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;G&#39;</span>;
</span></span><span style="display:flex;"><span>  array[<span style="color:#ae81ff">16</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;4&#39;</span>;
</span></span><span style="display:flex;"><span>  array[<span style="color:#ae81ff">17</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;6&#39;</span>;
</span></span><span style="display:flex;"><span>  array[<span style="color:#ae81ff">18</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;k&#39;</span>;
</span></span><span style="display:flex;"><span>  array[<span style="color:#ae81ff">19</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;s&#39;</span>;
</span></span><span style="display:flex;"><span>  array[<span style="color:#ae81ff">20</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;p&#39;</span>;
</span></span><span style="display:flex;"><span>  array[<span style="color:#ae81ff">21</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;w&#39;</span>;
</span></span><span style="display:flex;"><span>  array[<span style="color:#ae81ff">22</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;2&#39;</span>;
</span></span><span style="display:flex;"><span>  array[<span style="color:#ae81ff">23</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;H&#39;</span>;
</span></span><span style="display:flex;"><span>  array[<span style="color:#ae81ff">24</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;z&#39;</span>;
</span></span><span style="display:flex;"><span>  array[<span style="color:#ae81ff">25</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;f&#39;</span>;
</span></span><span style="display:flex;"><span>  array[<span style="color:#ae81ff">26</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;r&#39;</span>;
</span></span><span style="display:flex;"><span>  array[<span style="color:#ae81ff">27</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;O&#39;</span>;
</span></span><span style="display:flex;"><span>  array[<span style="color:#ae81ff">28</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;i&#39;</span>;
</span></span><span style="display:flex;"><span>  array[<span style="color:#ae81ff">29</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;h&#39;</span>;
</span></span><span style="display:flex;"><span>  array[<span style="color:#ae81ff">30</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;c&#39;</span>;
</span></span><span style="display:flex;"><span>  array[<span style="color:#ae81ff">31</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;U&#39;</span>;
</span></span></code></pre></div><p>On constate alors que notre intuition était la bonne. Si on passe maintenant à la suite du
programme, on trouve une boucle for:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C" data-lang="C"><span style="display:flex;"><span>  tVar2 <span style="color:#f92672">=</span> <span style="color:#a6e22e">time</span>((<span style="color:#66d9ef">time_t</span> <span style="color:#f92672">*</span>)<span style="color:#ae81ff">0x0</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">srandom</span>((uint)tVar2);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">for</span> (local_88 <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; local_88 <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">32</span>; local_88 <span style="color:#f92672">=</span> local_88 <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>) {
</span></span><span style="display:flex;"><span>    uVar3 <span style="color:#f92672">=</span> <span style="color:#a6e22e">random</span>();
</span></span><span style="display:flex;"><span>    local_78[local_88] <span style="color:#f92672">=</span> array[(<span style="color:#66d9ef">int</span>)uVar3 <span style="color:#f92672">+</span> ((<span style="color:#66d9ef">int</span>)(uVar3 <span style="color:#f92672">/</span> <span style="color:#ae81ff">0x3e</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">5</span>) <span style="color:#f92672">-</span> (<span style="color:#66d9ef">int</span>)(uVar3 <span style="color:#f92672">/</span> <span style="color:#ae81ff">0x3e</span>)) <span style="color:#f92672">*</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>];
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  array._0_8_ <span style="color:#f92672">=</span> array._0_8_ <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xffffffffffffff00</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">sleep</span>(<span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>  iVar1 <span style="color:#f92672">=</span> <span style="color:#a6e22e">access</span>((<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>)local_78,<span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (iVar1 <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>) {
</span></span><span style="display:flex;"><span>    uVar4 <span style="color:#f92672">=</span> <span style="color:#a6e22e">FUN_001011d9</span>(local_78);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>    uVar4 <span style="color:#f92672">=</span> <span style="color:#ae81ff">0xffffffd6</span>;
</span></span><span style="display:flex;"><span>  }
</span></span></code></pre></div><p>Une fois les variables renommées et retypées correctement, le code ressemble à ceci:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C" data-lang="C"><span style="display:flex;"><span>  current_time <span style="color:#f92672">=</span> <span style="color:#a6e22e">time</span>(NULL);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">srandom</span>(current_time);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">for</span> (i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">32</span>; i <span style="color:#f92672">=</span> i <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>) {
</span></span><span style="display:flex;"><span>    r <span style="color:#f92672">=</span> <span style="color:#a6e22e">random</span>();
</span></span><span style="display:flex;"><span>    filename[i] <span style="color:#f92672">=</span> array[r <span style="color:#f92672">+</span> ((r <span style="color:#f92672">/</span> <span style="color:#ae81ff">62</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">5</span>) <span style="color:#f92672">-</span> (r <span style="color:#f92672">/</span> <span style="color:#ae81ff">62</span>)) <span style="color:#f92672">*</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>];
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">sleep</span>(<span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>  file_exists <span style="color:#f92672">=</span> <span style="color:#a6e22e">access</span>(filename,<span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (file_exists <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>) {
</span></span><span style="display:flex;"><span>    result <span style="color:#f92672">=</span> <span style="color:#a6e22e">FUN_001011d9</span>(filename);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>    result <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">42</span>;
</span></span><span style="display:flex;"><span>  }
</span></span></code></pre></div><p>La boucle for initialise un tableau avec des elements pris au hasard via <code>random()</code> et construit
ainsi un nom de fichier qui sera donné en paramètre à la fonction <code>access</code>. Cette fonction teste
si le fichier passé en paramètre existe, renvoie 0 si c&rsquo;est le cas, -1 sinon. Ensuite, si le
fichier existe, la fonction <code>FUN_001011d9</code> est appelé avec comme paramètre le nom de fichier.</p>
<p>La fonction <code>FUN_001011d9</code> ouvre un fichier puis écrit des informations dans le fichier. En réalité,
elle écrit le flag dans le fichier mais la fonction a été obfusquée pour indiquer qu&rsquo;il n&rsquo;est pas
nécessaire de comprendre les opérations effectués pour réussir le challenge. Afin de valider,
il faut être capable de créer le fichier avec le bon nom avant de lancer le challenge.</p>
<p>Le script suivant permet de résoudre le challenge:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> ctypes
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> subprocess
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>KEY_SIZE <span style="color:#f92672">=</span> <span style="color:#ae81ff">32</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ALPHABET <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">0x62</span>, <span style="color:#ae81ff">0x6d</span>, <span style="color:#ae81ff">0x50</span>, <span style="color:#ae81ff">0x78</span>, <span style="color:#ae81ff">0x46</span>, <span style="color:#ae81ff">0x76</span>, <span style="color:#ae81ff">0x71</span>, <span style="color:#ae81ff">0x4c</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">0x75</span>, <span style="color:#ae81ff">0x35</span>, <span style="color:#ae81ff">0x49</span>, <span style="color:#ae81ff">0x58</span>, <span style="color:#ae81ff">0x4d</span>, <span style="color:#ae81ff">0x52</span>, <span style="color:#ae81ff">0x37</span>, <span style="color:#ae81ff">0x47</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">0x34</span>, <span style="color:#ae81ff">0x36</span>, <span style="color:#ae81ff">0x6b</span>, <span style="color:#ae81ff">0x73</span>, <span style="color:#ae81ff">0x70</span>, <span style="color:#ae81ff">0x77</span>, <span style="color:#ae81ff">0x32</span>, <span style="color:#ae81ff">0x48</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">0x7a</span>, <span style="color:#ae81ff">0x66</span>, <span style="color:#ae81ff">0x72</span>, <span style="color:#ae81ff">0x4f</span>, <span style="color:#ae81ff">0x69</span>, <span style="color:#ae81ff">0x68</span>, <span style="color:#ae81ff">0x63</span>, <span style="color:#ae81ff">0x55</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">0x6f</span>, <span style="color:#ae81ff">0x4e</span>, <span style="color:#ae81ff">0x56</span>, <span style="color:#ae81ff">0x45</span>, <span style="color:#ae81ff">0x31</span>, <span style="color:#ae81ff">0x64</span>, <span style="color:#ae81ff">0x30</span>, <span style="color:#ae81ff">0x38</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">0x6c</span>, <span style="color:#ae81ff">0x6e</span>, <span style="color:#ae81ff">0x44</span>, <span style="color:#ae81ff">0x53</span>, <span style="color:#ae81ff">0x43</span>, <span style="color:#ae81ff">0x5a</span>, <span style="color:#ae81ff">0x33</span>, <span style="color:#ae81ff">0x61</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">0x54</span>, <span style="color:#ae81ff">0x4a</span>, <span style="color:#ae81ff">0x79</span>, <span style="color:#ae81ff">0x57</span>, <span style="color:#ae81ff">0x42</span>, <span style="color:#ae81ff">0x51</span>, <span style="color:#ae81ff">0x39</span>, <span style="color:#ae81ff">0x67</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">0x65</span>, <span style="color:#ae81ff">0x6a</span>, <span style="color:#ae81ff">0x59</span>, <span style="color:#ae81ff">0x4b</span>, <span style="color:#ae81ff">0x74</span>, <span style="color:#ae81ff">0x41</span>
</span></span><span style="display:flex;"><span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">main</span>():
</span></span><span style="display:flex;"><span>    libc <span style="color:#f92672">=</span> ctypes<span style="color:#f92672">.</span>CDLL(<span style="color:#e6db74">&#34;libc.so.6&#34;</span>)
</span></span><span style="display:flex;"><span>    seed <span style="color:#f92672">=</span> libc<span style="color:#f92672">.</span>time(<span style="color:#66d9ef">None</span>)
</span></span><span style="display:flex;"><span>    libc<span style="color:#f92672">.</span>srandom(seed)
</span></span><span style="display:flex;"><span>    filename <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(KEY_SIZE):
</span></span><span style="display:flex;"><span>        value <span style="color:#f92672">=</span> libc<span style="color:#f92672">.</span>random() <span style="color:#f92672">%</span> len(ALPHABET)
</span></span><span style="display:flex;"><span>        filename <span style="color:#f92672">+=</span> chr(ALPHABET[value])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    open(filename, <span style="color:#e6db74">&#39;w&#39;</span>)<span style="color:#f92672">.</span>close()
</span></span><span style="display:flex;"><span>    subprocess<span style="color:#f92672">.</span>run([<span style="color:#e6db74">&#39;./keygen&#39;</span>, <span style="color:#e6db74">&#39;test&#39;</span>])
</span></span><span style="display:flex;"><span>    subprocess<span style="color:#f92672">.</span>run([<span style="color:#e6db74">&#39;cat&#39;</span>, filename])
</span></span><span style="display:flex;"><span>    subprocess<span style="color:#f92672">.</span>run([<span style="color:#e6db74">&#39;rm&#39;</span>, filename])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;__main__&#39;</span>:
</span></span><span style="display:flex;"><span>    main()
</span></span></code></pre></div><p>La boucle for qui effectue des opérations compliquées (<code>r + ((r / 62 &lt;&lt; 5) - (r / 62)) * -2</code>),
effecute en réalité l&rsquo;opération modulo. Le code obtenu est le résultat d&rsquo;une optimisation du compilateur.
Il était possible de comprendre la nature de l&rsquo;opération, en générant l&rsquo;ensemble des valeurs possibles
à partir de <code>r</code> comme ceci:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">&gt;&gt;&gt;</span> [(r <span style="color:#f92672">+</span> ((r <span style="color:#f92672">//</span> <span style="color:#ae81ff">62</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">5</span>) <span style="color:#f92672">-</span> (r <span style="color:#f92672">//</span> <span style="color:#ae81ff">62</span>)) <span style="color:#f92672">*</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>) <span style="color:#66d9ef">for</span> r <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">70</span>)]
</span></span><span style="display:flex;"><span>[<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">6</span>, <span style="color:#ae81ff">7</span>, <span style="color:#ae81ff">8</span>, <span style="color:#ae81ff">9</span>, <span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">11</span>, <span style="color:#ae81ff">12</span>, <span style="color:#ae81ff">13</span>, <span style="color:#ae81ff">14</span>, <span style="color:#ae81ff">15</span>, <span style="color:#ae81ff">16</span>, <span style="color:#ae81ff">17</span>, <span style="color:#ae81ff">18</span>, <span style="color:#ae81ff">19</span>, <span style="color:#ae81ff">20</span>, <span style="color:#ae81ff">21</span>, <span style="color:#ae81ff">22</span>, 
</span></span><span style="display:flex;"><span> <span style="color:#ae81ff">23</span>, <span style="color:#ae81ff">24</span>, <span style="color:#ae81ff">25</span>, <span style="color:#ae81ff">26</span>, <span style="color:#ae81ff">27</span>, <span style="color:#ae81ff">28</span>, <span style="color:#ae81ff">29</span>, <span style="color:#ae81ff">30</span>, <span style="color:#ae81ff">31</span>, <span style="color:#ae81ff">32</span>, <span style="color:#ae81ff">33</span>, <span style="color:#ae81ff">34</span>, <span style="color:#ae81ff">35</span>, <span style="color:#ae81ff">36</span>, <span style="color:#ae81ff">37</span>, <span style="color:#ae81ff">38</span>, <span style="color:#ae81ff">39</span>, <span style="color:#ae81ff">40</span>, <span style="color:#ae81ff">41</span>, <span style="color:#ae81ff">42</span>, 
</span></span><span style="display:flex;"><span> <span style="color:#ae81ff">43</span>, <span style="color:#ae81ff">44</span>, <span style="color:#ae81ff">45</span>, <span style="color:#ae81ff">46</span>, <span style="color:#ae81ff">47</span>, <span style="color:#ae81ff">48</span>, <span style="color:#ae81ff">49</span>, <span style="color:#ae81ff">50</span>, <span style="color:#ae81ff">51</span>, <span style="color:#ae81ff">52</span>, <span style="color:#ae81ff">53</span>, <span style="color:#ae81ff">54</span>, <span style="color:#ae81ff">55</span>, <span style="color:#ae81ff">56</span>, <span style="color:#ae81ff">57</span>, <span style="color:#ae81ff">58</span>, <span style="color:#ae81ff">59</span>, <span style="color:#ae81ff">60</span>, <span style="color:#ae81ff">61</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>, 
</span></span><span style="display:flex;"><span> <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">6</span>, <span style="color:#ae81ff">7</span>]
</span></span></code></pre></div><p>On peut voir que le résultat ne dépasse jamais <code>62</code> qui est la taille de notre tableau
de chaîne de caractères. En exécutant le script de solution, on obtient:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>python solve.py
</span></span><span style="display:flex;"><span>Flag<span style="color:#f92672">{</span>h0p3_y0u_l1k3_k3y63n<span style="color:#f92672">}</span>
</span></span></code></pre></div><h2 id="solution-ii---dynamique">Solution II - Dynamique</h2>
<p>Si on veut éviter d&rsquo;avoir à générer un nom de fichier correct, il est possible d&rsquo;utiliser
<code>gdb</code> pour obtenir le nom du fichier, le créer et continuer l&rsquo;exécution via un breakpoint
à la fonction <code>access</code>. On obtient alors:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>gdb ./keygen
</span></span><span style="display:flex;"><span>Reading symbols from ./keygen...
</span></span><span style="display:flex;"><span><span style="color:#f92672">(</span>gdb<span style="color:#f92672">)</span> break access
</span></span><span style="display:flex;"><span>Breakpoint <span style="color:#ae81ff">1</span> at 0x10a0
</span></span><span style="display:flex;"><span><span style="color:#f92672">(</span>gdb<span style="color:#f92672">)</span> set args test
</span></span><span style="display:flex;"><span><span style="color:#f92672">(</span>gdb<span style="color:#f92672">)</span> run
</span></span><span style="display:flex;"><span>Starting program: /home/user/keygen test
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>Thread debugging using libthread_db enabled<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>Using host libthread_db library <span style="color:#e6db74">&#34;/usr/lib/libthread_db.so.1&#34;</span>.
</span></span><span style="display:flex;"><span>Breakpoint 1, 0x00007ffff7eaaae0 in access <span style="color:#f92672">()</span> from /usr/lib/libc.so.6
</span></span><span style="display:flex;"><span><span style="color:#f92672">(</span>gdb<span style="color:#f92672">)</span> x/s $rdi
</span></span><span style="display:flex;"><span>0x7fffffffdc10:	<span style="color:#e6db74">&#34;QXzn5FCodUrs27R3Sr54t1G68AQiWP1l&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">(</span>gdb<span style="color:#f92672">)</span> python open<span style="color:#f92672">(</span><span style="color:#e6db74">&#39;QXzn5FCodUrs27R3Sr54t1G68AQiWP1l&#39;</span>, <span style="color:#e6db74">&#39;w&#39;</span><span style="color:#f92672">)</span>.close<span style="color:#f92672">()</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">(</span>gdb<span style="color:#f92672">)</span> <span style="color:#66d9ef">continue</span>
</span></span><span style="display:flex;"><span>Continuing.
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>Inferior <span style="color:#ae81ff">1</span> <span style="color:#f92672">(</span>process 31747<span style="color:#f92672">)</span> exited normally<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">(</span>gdb<span style="color:#f92672">)</span> quit
</span></span></code></pre></div><p>On effectue les opérations suivantes:</p>
<ul>
<li>On place un breakpoint sur la fonction <code>access</code>.</li>
<li>On donne comme argument <code>test</code> via <code>set args</code>.</li>
<li>On lance le programme via la commande <code>run</code>. Gdb va exécuter notre programme jusqu&rsquo;au breakpoint.</li>
<li>On récupère la main juste avant l&rsquo;appel à <code>access</code>. On sait que le premier argument de <code>access</code>
contient le nom du fichier que l&rsquo;on doit créer. En x86_64, le premier argument d&rsquo;une fonction
se situe dans le registre <code>rdi</code>. On l&rsquo;affiche avec <code>x/s $rdi</code>.</li>
<li>On créer notre fichier grâce à python depuis gdb avec la commande:
<code>python open('QXzn5FCodUrs27R3Sr54t1G68AQiWP1l', 'w').close()</code>.</li>
<li>Enfin, on continue le reste de l&rsquo;exécution grâce à la commande <code>continue</code>.</li>
</ul>
<p>Si on affiche le fichier que l&rsquo;on vient de créer, on obtient alors :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>cat QXzn5FCodUrs27R3Sr54t1G68AQiWP1l
</span></span><span style="display:flex;"><span>Flag<span style="color:#f92672">{</span>h0p3_y0u_l1k3_k3y63n<span style="color:#f92672">}</span>
</span></span></code></pre></div><ul class="pa0">
  
</ul>
<div class="mt6 instapaper_ignoref">
      
      
      </div>
    </div><aside class="w-30-l mt6-l">








</aside></article>

    </main>
    <footer class="bg-black-90 bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
    <a class="f4 fw4 hover-white white-70 dn dib-ns pv2 ph3 no-underline" href="https://jeanned-hack-ctf.github.io/" >
      &copy;  Jeanne d'Hack CTF. Tous droits réservés. 2026 
    </a>
    <div class="flex">
      <div class="f4 fw4 white-70 dn dib-ns pv2 ph3">
        
          <a class="hover-white white-70 no-underline" href="/legal/">Mentions légales</a>
          &nbsp;&nbsp;&centerdot;
        
      </div>
      <div>
        <div class="ananke-socials"><a href="https://www.instagram.com/jeannedhackctf/" target="_blank" rel="noopener"
        class="ananke-social-link link-transition instagram link dib z-999 pt3 pt0-l mr1"
        title="follow on Instagram - Opens in a new window"
        aria-label="follow on Instagram - Opens in a new window">
      <span class="icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc. --><path d="M224.1 141c-63.6 0-114.9 51.3-114.9 114.9s51.3 114.9 114.9 114.9S339 319.5 339 255.9 287.7 141 224.1 141zm0 189.6c-41.1 0-74.7-33.5-74.7-74.7s33.5-74.7 74.7-74.7 74.7 33.5 74.7 74.7-33.6 74.7-74.7 74.7zm146.4-194.3c0 14.9-12 26.8-26.8 26.8-14.9 0-26.8-12-26.8-26.8s12-26.8 26.8-26.8 26.8 12 26.8 26.8zm76.1 27.2c-1.7-35.9-9.9-67.7-36.2-93.9-26.2-26.2-58-34.4-93.9-36.2-37-2.1-147.9-2.1-184.9 0-35.8 1.7-67.6 9.9-93.9 36.1s-34.4 58-36.2 93.9c-2.1 37-2.1 147.9 0 184.9 1.7 35.9 9.9 67.7 36.2 93.9s58 34.4 93.9 36.2c37 2.1 147.9 2.1 184.9 0 35.9-1.7 67.7-9.9 93.9-36.2 26.2-26.2 34.4-58 36.2-93.9 2.1-37 2.1-147.8 0-184.8zM398.8 388c-7.8 19.6-22.9 34.7-42.6 42.6-29.5 11.7-99.5 9-132.1 9s-102.7 2.6-132.1-9c-19.6-7.8-34.7-22.9-42.6-42.6-11.7-29.5-9-99.5-9-132.1s-2.6-102.7 9-132.1c7.8-19.6 22.9-34.7 42.6-42.6 29.5-11.7 99.5-9 132.1-9s102.7-2.6 132.1 9c19.6 7.8 34.7 22.9 42.6 42.6 11.7 29.5 9 99.5 9 132.1s2.7 102.7-9 132.1z"/></svg>
            
          </span></a><a href="http://linkedin.com/company/jeanne-d-hack-ctf" target="_blank" rel="noopener"
        class="ananke-social-link link-transition linkedin link dib z-999 pt3 pt0-l mr1"
        title="follow on LinkedIn - Opens in a new window"
        aria-label="follow on LinkedIn - Opens in a new window">
      <span class="icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc. --><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>
            
          </span></a><a href="https://discord.gg/nbqQEe7qXB" target="_blank" rel="noopener"
        class="ananke-social-link link-transition discord link dib z-999 pt3 pt0-l mr1"
        title="follow on Discord - Opens in a new window"
        aria-label="follow on Discord - Opens in a new window">
      <span class="icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc. --><path d="M524.531,69.836a1.5,1.5,0,0,0-.764-.7A485.065,485.065,0,0,0,404.081,32.03a1.816,1.816,0,0,0-1.923.91,337.461,337.461,0,0,0-14.9,30.6,447.848,447.848,0,0,0-134.426,0,309.541,309.541,0,0,0-15.135-30.6,1.89,1.89,0,0,0-1.924-.91A483.689,483.689,0,0,0,116.085,69.137a1.712,1.712,0,0,0-.788.676C39.068,183.651,18.186,294.69,28.43,404.354a2.016,2.016,0,0,0,.765,1.375A487.666,487.666,0,0,0,176.02,479.918a1.9,1.9,0,0,0,2.063-.676A348.2,348.2,0,0,0,208.12,430.4a1.86,1.86,0,0,0-1.019-2.588,321.173,321.173,0,0,1-45.868-21.853,1.885,1.885,0,0,1-.185-3.126c3.082-2.309,6.166-4.711,9.109-7.137a1.819,1.819,0,0,1,1.9-.256c96.229,43.917,200.41,43.917,295.5,0a1.812,1.812,0,0,1,1.924.233c2.944,2.426,6.027,4.851,9.132,7.16a1.884,1.884,0,0,1-.162,3.126,301.407,301.407,0,0,1-45.89,21.83,1.875,1.875,0,0,0-1,2.611,391.055,391.055,0,0,0,30.014,48.815,1.864,1.864,0,0,0,2.063.7A486.048,486.048,0,0,0,610.7,405.729a1.882,1.882,0,0,0,.765-1.352C623.729,277.594,590.933,167.465,524.531,69.836ZM222.491,337.58c-28.972,0-52.844-26.587-52.844-59.239S193.056,219.1,222.491,219.1c29.665,0,53.306,26.82,52.843,59.239C275.334,310.993,251.924,337.58,222.491,337.58Zm195.38,0c-28.971,0-52.843-26.587-52.843-59.239S388.437,219.1,417.871,219.1c29.667,0,53.307,26.82,52.844,59.239C470.715,310.993,447.538,337.58,417.871,337.58Z"/></svg>
            
          </span></a><a href="https://github.com/JeanneD-Hack-CTF/" target="_blank" rel="noopener"
        class="ananke-social-link link-transition github link dib z-999 pt3 pt0-l mr1"
        title="follow on GitHub - Opens in a new window"
        aria-label="follow on GitHub - Opens in a new window">
      <span class="icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc. --><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
            
          </span></a></div>

      </div>
    </div>
  </div>
</footer>
  </body>
</html>
