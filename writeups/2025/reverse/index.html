<!DOCTYPE html>
<html lang="fr-FR">
  <head>
    <meta charset="utf-8">
    <script type="text/javascript">
      
      if (window.location.protocol !== 'https:' && window.location.hostname !== 'localhost') {
        window.location.href = 'https://' + window.location.host + window.location.pathname + window.location.search;
      }
    </script>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>Writeup Reverse Engineering - Edition 2025 | </title>
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="description" content="Dans cet article, nous vous présenterons les différentes solutions aux challenges
du Jeanne d&rsquo;Hack CTF 2025 pour la catégorie Reverse.

Rev My Snake I
Rev My Snake II
Rev My Snake III
ORnithorynque
Next Level
Kudo
CustomFs

Rev My Snake I
Les sources du challenge sont disponibles ici.
Writeup by Tourte
Description
Ce challenge est le premier challenge de reverse de la série &ldquo;Rev my snake&rdquo;. Il est
classé facile et n&rsquo;a pas posé beaucoup de problèmes à la majorité des participants.">
    <meta name="generator" content="Hugo 0.143.1">
    
    
    
      <meta name="robots" content="index, follow">
    
    

    
<link rel="stylesheet" href="/ananke/css/main.min.d0769c6e76ec01cc50a9b248214d5ae29247d2966cf3fe5c6a470ed0e8edd3a3.css" >



    

    
      

    

    

    
      <link rel="canonical" href="https://jeanned-hack-ctf.github.io/writeups/2025/reverse/">
    

    <meta property="og:url" content="https://jeanned-hack-ctf.github.io/writeups/2025/reverse/">
  <meta property="og:title" content="Writeup Reverse Engineering - Edition 2025">
  <meta property="og:description" content="Dans cet article, nous vous présenterons les différentes solutions aux challenges du Jeanne d’Hack CTF 2025 pour la catégorie Reverse.
Rev My Snake I Rev My Snake II Rev My Snake III ORnithorynque Next Level Kudo CustomFs Rev My Snake I Les sources du challenge sont disponibles ici.
Writeup by Tourte
Description Ce challenge est le premier challenge de reverse de la série “Rev my snake”. Il est classé facile et n’a pas posé beaucoup de problèmes à la majorité des participants.">
  <meta property="og:locale" content="fr_FR">
  <meta property="og:type" content="article">
    <meta property="article:section" content="writeups">
    <meta property="article:published_time" content="2025-02-19T00:00:00+00:00">
    <meta property="article:modified_time" content="2025-02-19T00:00:00+00:00">

  <meta itemprop="name" content="Writeup Reverse Engineering - Edition 2025">
  <meta itemprop="description" content="Dans cet article, nous vous présenterons les différentes solutions aux challenges du Jeanne d’Hack CTF 2025 pour la catégorie Reverse.
Rev My Snake I Rev My Snake II Rev My Snake III ORnithorynque Next Level Kudo CustomFs Rev My Snake I Les sources du challenge sont disponibles ici.
Writeup by Tourte
Description Ce challenge est le premier challenge de reverse de la série “Rev my snake”. Il est classé facile et n’a pas posé beaucoup de problèmes à la majorité des participants.">
  <meta itemprop="datePublished" content="2025-02-19T00:00:00+00:00">
  <meta itemprop="dateModified" content="2025-02-19T00:00:00+00:00">
  <meta itemprop="wordCount" content="7066">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Writeup Reverse Engineering - Edition 2025">
  <meta name="twitter:description" content="Dans cet article, nous vous présenterons les différentes solutions aux challenges du Jeanne d’Hack CTF 2025 pour la catégorie Reverse.
Rev My Snake I Rev My Snake II Rev My Snake III ORnithorynque Next Level Kudo CustomFs Rev My Snake I Les sources du challenge sont disponibles ici.
Writeup by Tourte
Description Ce challenge est le premier challenge de reverse de la série “Rev my snake”. Il est classé facile et n’a pas posé beaucoup de problèmes à la majorité des participants.">

      
    

    

    
    
      <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
<script>
  MathJax = {
    tex: {
      displayMath: [['$$', '$$'], ['\\[', '\\]']],
      inlineMath: [['$', '$'], ['\\(', '\\)']]
    },
    loader:{
      load: ['ui/safe']
    },
  };
</script>

    
  </head><body class="ma0 avenir bg-near-white production">

    
   
  

  
  
  <header class="contain bg-center bg-black" style="background-image: url('https://jeanned-hack-ctf.github.io/images/background.svg');">
    
    <div class="bg-black-10">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="/" class="f3 fw2 hover-white no-underline white-90 dib">
      
        <img src="/images/logo.svg" class="w100 mw5-ns" alt="" />
      
    </a>
    <div id="dropdown-list" class="flex-l items-center">
      

      
        <ul class="pl0 mr3">
          
            
              <li class="list f5 f4-ns fw4 dib pr3">
                <a class="hover-white no-underline white-90" href="/inscriptions/" title="Inscriptions page">
                  Inscriptions
                </a>
              </li>
            
          
            
              <li class="list f5 f4-ns fw4 dib has-dropdown pr3">
                <a class="hover-white no-underline white-90" href="/post/" title="Editions Précedentes page">
                  Editions Précedentes
                </a>
                <ul class="dropdown">
                  
                    <li class="f5 f4-ns fw4 dib pr3">
                      <a class="hover-white no-underline white-90" href="/post/2024/" title="Edition 2024 page">
                        Edition 2024
                      </a>
                    </li>
                  
                    <li class="f5 f4-ns fw4 dib pr3">
                      <a class="hover-white no-underline white-90" href="/post/2025/" title="Edition 2025 page">
                        Edition 2025
                      </a>
                    </li>
                  
                </ul>
              </li>
            
          
            
              <li class="list f5 f4-ns fw4 dib has-dropdown pr3">
                <a class="hover-white no-underline white-90" href="/writeups/" title="Write-Ups page">
                  Write-Ups
                </a>
                <ul class="dropdown">
                  
                    <li class="f5 f4-ns fw4 dib pr3">
                      <a class="hover-white no-underline white-90" href="/writeups/2025/" title="Write-ups 2025 page">
                        Write-ups 2025
                      </a>
                    </li>
                  
                    <li class="f5 f4-ns fw4 dib pr3">
                      <a class="hover-white no-underline white-90" href="/writeups/2026/" title="Write-ups 2026 page">
                        Write-ups 2026
                      </a>
                    </li>
                  
                </ul>
              </li>
            
          
        </ul>
      
      <div class="ananke-socials"></div>

    </div>
  </div>
</nav>

      <div class="tc-l pv4 pv6-l ph3 ph4-ns">
      </div>
    </div>
  </header>



    <main class="pb7" role="main">
      
  
  <article class="flex-l flex-wrap justify-between mw8 center ph3">
    <header class="mt4 w-100">
      <aside class="instapaper_ignoref b helvetica tracked ttu">
          
        Write-ups 2025
      </aside><div id="sharing" class="mt3 ananke-socials"></div>
<h1 class="f1 athelas mt3 mb1">Writeup Reverse Engineering - Edition 2025</h1>
      
      
      
      <time class="f6 mv4 dib tracked" datetime="2025-02-19T00:00:00Z">février 19, 2025</time>
      

      
      
    </header>
    <div class="nested-copy-line-height lh-copy serif f4 nested-links mid-gray pr4-l"><p>Dans cet article, nous vous présenterons les différentes solutions aux challenges
du Jeanne d&rsquo;Hack CTF 2025 pour la catégorie <a href="https://github.com/JeanneD-Hack-CTF/JeanneD-Hack-CTF-2025/tree/main/reverse">Reverse</a>.</p>
<ul>
<li><a href="#rev-my-snake-i">Rev My Snake I</a></li>
<li><a href="#rev-my-snake-ii">Rev My Snake II</a></li>
<li><a href="#rev-my-snake-iii">Rev My Snake III</a></li>
<li><a href="#ornithorynque">ORnithorynque</a></li>
<li><a href="#next-level">Next Level</a></li>
<li><a href="#kudo">Kudo</a></li>
<li><a href="#customfs">CustomFs</a></li>
</ul>
<h2 id="rev-my-snake-i">Rev My Snake I</h2>
<p>Les sources du challenge sont disponibles <a href="https://github.com/JeanneD-Hack-CTF/JeanneD-Hack-CTF-2025/tree/main/reverse/Rev_My_Snake_I">ici</a>.</p>
<p>Writeup by <a href="https://www.linkedin.com/in/lucas-coussement-73bb0927b">Tourte</a></p>
<h3 id="description">Description</h3>
<p>Ce challenge est le premier challenge de reverse de la série <strong>&ldquo;Rev my snake&rdquo;</strong>. Il est
classé <strong>facile</strong> et n&rsquo;a pas posé beaucoup de problèmes à la majorité des participants.</p>
<h3 id="outils-nécessaires">Outils nécessaires</h3>
<ul>
<li>Un éditeur de texte classique</li>
<li>Python (pour pouvoir exécuter le script)</li>
</ul>
<h3 id="fichiers-fournis">Fichiers fournis</h3>
<ul>
<li><code>chall.py</code> : Le script python à analyser</li>
</ul>
<h3 id="résolution">Résolution</h3>
<p>Si on regarde <code>__init__</code>, qui représente le point d&rsquo;entrée du script, on voit que celui-ci
exécute la fonction <code>main</code> (ce qui est logiquement ce que font énormément de scripts Python).
Si vous avez lancé le script, vous avez dû voir qu&rsquo;à un moment on vous demande de rentrer
un mot de passe. La majorité du temps dans ce genre de challenge, l&rsquo;objectif est de trouver
le <strong>point d&rsquo;entrée</strong> (là où le script va prendre ce que vous allez entrer) et de suivre toutes
les étapes pour comprendre comment le script va traiter votre entrée et à quoi elle va être comparée.</p>
<p>En Python, la prise d&rsquo;entrée est gérée par la fonction <code>input</code>. Nous allons donc chercher où
cette fonction est appelée dans le <code>main</code> pour déterminer tous les inputs et trouver celui
qui nous intéresse (celui du mot de passe, hehe).</p>
<p>En cherchant un peu, on trouve une ligne vachement intéressante :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#ae81ff">57</span><span style="color:#f92672">|</span> string <span style="color:#f92672">=</span> input(<span style="color:#e6db74">&#39;Enter the password: &#39;</span>)
</span></span></code></pre></div><p>Le mot de passe est donc stocké dans une variable <code>string</code>. On peut alors suivre ce que le script fait de notre mot de passe en suivant cette variable. Ce qui n&rsquo;est pas compliqué puisque la ligne qui suit montre que le script fait passer notre mot de passe dans une fonction <code>check_password</code> qui renvoie un booléen (forcément, elle est dans un <code>if</code>).</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#66d9ef">if</span> check_password(string):
</span></span><span style="display:flex;"><span>  dialog(<span style="color:#e6db74">&#39;Anonymous&#39;</span>, <span style="color:#e6db74">&#39;DAMN!&#39;</span>)
</span></span><span style="display:flex;"><span>  pause(<span style="color:#ae81ff">20</span>)
</span></span><span style="display:flex;"><span>  dialog(<span style="color:#e6db74">&#39;Anonymous&#39;</span>, <span style="color:#e6db74">&#34;I let you win this time, but next time it won&#39;t be that easy!&#34;</span>)
</span></span><span style="display:flex;"><span>  pause(<span style="color:#ae81ff">20</span>)
</span></span><span style="display:flex;"><span>  dialog(<span style="color:#e6db74">&#39;Anonymous&#39;</span>, <span style="color:#e6db74">&#39;Here is your precious flag:</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">JDHACK{</span><span style="color:#e6db74">%s</span><span style="color:#e6db74">}&#39;</span> <span style="color:#f92672">%</span> string)
</span></span><span style="display:flex;"><span>  dialog(<span style="color:#e6db74">&#39;System&#39;</span>, <span style="color:#e6db74">&#39;Anonymous Left&#39;</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">break</span>
</span></span></code></pre></div><p>On comprend facilement que si <code>check_password</code> renvoie <code>True</code>, on aura le flag. On va donc gentiment
analyser cette fonction pour comprendre ce qu&rsquo;elle fait.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">check_password</span>(string):
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># a = les 14 premiers caractères</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># b = les 14 derniers caractères</span>
</span></span><span style="display:flex;"><span>  a, b <span style="color:#f92672">=</span> (string[:<span style="color:#ae81ff">14</span>], string[<span style="color:#ae81ff">14</span>:])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># Nous envoie bouler si a n&#39;est pas égal à b en taille</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> len(a) <span style="color:#f92672">!=</span> len(b):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">False</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Vérifie que b est égal à &#39;n0htyP_c3vA_35&#39; en inversé donc</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># &#39;53_Av3c_Pyth0n&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> b[::<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#39;n0htyP_c3vA_35&#39;</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">False</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Enlève 13 à chaque caractère de a et vérifie que a est la chaine</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># bizarre</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#39;&#39;</span><span style="color:#f92672">.</span>join([chr(ord(e) <span style="color:#f92672">-</span> <span style="color:#ae81ff">13</span>) <span style="color:#66d9ef">for</span> e <span style="color:#f92672">in</span> a]) <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#39;&lt;a*e#R4hRE&amp;i&amp;e&#39;</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">False</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">True</span>
</span></span></code></pre></div><p>On comprend que notre chaîne est divisée en deux parties <code>a</code> et <code>b</code>.</p>
<ul>
<li><code>a</code> représente les 14 premiers caractères de notre mot de passe</li>
<li><code>b</code> représente les 14 derniers</li>
</ul>
<p>On voit aussi qu&rsquo;on nous renvoie <code>False</code> si <code>a</code> et <code>b</code> n&rsquo;ont pas la même taille, ce qui veut dire
que notre mot de passe doit faire 28 caractères.</p>
<p>Ensuite, on voit que <code>b[::-1]</code> doit être égal à <code>n0htyP_c3vA_35</code>. Donc, le renversé de <code>b</code> doit être
égal à <code>n0htyP_c3vA_35</code>. On peut alors facilement retrouver <code>b</code> en faisant le renversé de <code>n0htyP_c3vA_35</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span>print(<span style="color:#e6db74">&#39;n0htyP_c3vA_35&#39;</span>[::<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>])
</span></span><span style="display:flex;"><span><span style="color:#75715e"># renvoie 53_Av3c_Pyth0n</span>
</span></span></code></pre></div><p>Si on regarde <code>a</code>, on voit que chaque caractère est décalé de 13 vers le bas et est comparé
à <code>'&lt;a*e#R4hRE&amp;i&amp;e'</code>. On comprend alors que <code>a</code> doit être égal à <code>'&lt;a*e#R4hRE&amp;i&amp;e'</code> décalé de 13 vers le haut.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span>print(<span style="color:#e6db74">&#39;&#39;</span><span style="color:#f92672">.</span>join([chr(ord(e) <span style="color:#f92672">+</span> <span style="color:#ae81ff">13</span>) <span style="color:#66d9ef">for</span> e <span style="color:#f92672">in</span> <span style="color:#e6db74">&#39;&lt;a*e#R4hRE&amp;i&amp;e&#39;</span>]))
</span></span><span style="display:flex;"><span><span style="color:#75715e"># renvoie &#39;In7r0_Au_R3v3r`</span>
</span></span></code></pre></div><p>Si on concatène <code>a</code> et <code>b</code>, on obtient le magnifique message <code>In7r0_Au_R3v3r53_Av3c_Pyth0n</code> (<em>intro au
reverse avec Python</em>), qui est notre mot de passe et aussi notre flag au passage (<code>JDHACK{In7r0_Au_R3v3r53_Av3c_Pyth0n}</code>).</p>
<h2 id="rev-my-snake-ii">Rev My Snake II</h2>
<p>Les sources du challenge sont disponibles <a href="https://github.com/JeanneD-Hack-CTF/JeanneD-Hack-CTF-2025/tree/main/reverse/Rev_My_Snake_II">ici</a>.</p>
<p>Writeup by <a href="https://www.linkedin.com/in/lucas-coussement-73bb0927b">Tourte</a></p>
<h3 id="description-1">Description</h3>
<p>Ce challenge est le deuxième challenge de reverse de la série <strong>&ldquo;Rev my snake&rdquo;</strong>. Il est classé
<strong>facile</strong> comme le premier et a globalement plutôt été réussi par les participant du CTF.</p>
<h3 id="outils-nécessaires-1">Outils nécessaires</h3>
<ul>
<li>Un éditeur de texte classique</li>
<li>Python (pour pouvoir exécuter le script)</li>
</ul>
<h3 id="fichiers-fournis-1">Fichiers fournis</h3>
<ul>
<li><code>chall.py</code> : Le script python à analyser</li>
<li><code>securelib.py</code> : Un fichier additionnel utilisé par <code>chall.py</code></li>
</ul>
<h3 id="résolution-1">Résolution</h3>
<p>Ici, le fichier <code>chall.py</code> est quasiment identique à celui du challenge précédent. À la seule
différence que la fonction <code>check_password</code> ne se trouve pas dans le script principal, mais
dans un autre fichier additionnel <code>securelib.py</code> qui est importé.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">from</span> securelib <span style="color:#f92672">import</span> check_password
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">except</span> <span style="color:#a6e22e">Exception</span> <span style="color:#66d9ef">as</span> e:
</span></span><span style="display:flex;"><span>  print(<span style="color:#e6db74">&#39;O_o: oups... something went wrong&#39;</span>)
</span></span><span style="display:flex;"><span>  exit(<span style="color:#f92672">-</span><span style="color:#ae81ff">42</span>)
</span></span></code></pre></div><p>Nous allons devoir nous pencher sur le fichier <code>securelib.py</code> pour comprendre comment
fonctionne la fonction <code>check_password</code>, sauf que cette fois-ci (petite douche froide),
le fichier <code>securelib.py</code> ne sera pas lisible en clair.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span>XR <span style="color:#f92672">=</span> <span style="color:#66d9ef">lambda</span> x, k:  bytes([c <span style="color:#f92672">^</span> k <span style="color:#66d9ef">for</span> c <span style="color:#f92672">in</span> x]); HX <span style="color:#f92672">=</span> <span style="color:#66d9ef">lambda</span> e: bytes<span style="color:#f92672">.</span>fromhex(e)
</span></span><span style="display:flex;"><span>exec(XR(HX((
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;204e4f4c0a7549424f4941755a4b59595d45584e0a02656565651a65651a1a651a1a1a656565650a0&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;310200a0a0a0a6565651a65651a65651a1a1a1a1a651a1a0a17711b1b1a0a061c120a06131a0a061f&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;180a06131b0a06121b0a061b1b1b0a061b1a1c0a061b1a130a06121c0a061e190a06121e0a061b181&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;90a061b1a1a0a061c1c0a061c180a061d130a061b181d0a06191e0a061b1a190a061d1f0a061c1e0a&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;061b1a1b0a0612180a061d1b0a061d190a061c1d0a061e1e0a06121e0a0612180a061b1b180a77200&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;a0a0a0a434c0a464f440a026565651a65651a65651a1a1a1a1a651a1a0a030b17464f440a02656565&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;651a65651a1a651a1a1a656565650a0310200a0a0a0a0a0a0a0a584f5e5f58440a6c4b46594f200a0&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;a0a0a4c45580a651a1a651a1a1a1a651a1a1a1a656565650a43440a584b444d4f0a02464f440a0265&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;6565651a65651a1a651a1a1a656565650a030310200a0a0a0a0a0a0a0a434c0a45584e0a026565656&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;51a65651a1a651a1a1a656565650a71651a1a651a1a1a1a651a1a1a1a656565650a770374651a1a65&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;1a1a1a1a651a1a1a1a656565650a0b176565651a65651a65651a1a1a1a1a651a1a0a71651a1a651a1&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;a1a1a651a1a1a1a656565650a7710200a0a0a0a0a0a0a0a0a0a0a0a584f5e5f58440a6c4b46594f20&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;0a0a0a0a584f5e5f58440a7e585f4f2020&#34;</span>)), <span style="color:#ae81ff">42</span>)
</span></span><span style="display:flex;"><span>     ) 
</span></span><span style="display:flex;"><span>check_password <span style="color:#f92672">=</span> <span style="color:#66d9ef">lambda</span> e: eval(XR(HX(<span style="color:#e6db74">&#39;526e65686e66527d6c7e7e7a627f69&#39;</span>), <span style="color:#ae81ff">13</span>)<span style="color:#f92672">.</span>decode()<span style="color:#f92672">+</span><span style="color:#e6db74">&#34;(&#39;</span><span style="color:#e6db74">{}</span><span style="color:#e6db74">&#39;)&#34;</span><span style="color:#f92672">.</span>format(e))
</span></span></code></pre></div><p>Si on plisse les yeux et qu&rsquo;on décortique un peu le code, on arrive à comprendre ce qui
se passe. Ici, deux lambda fonctions sont définies :</p>
<ul>
<li><code>XR</code>, qui prend <code>x</code> et <code>k</code> en paramètre et qui effectue un XOR entre chaque caractère de <code>x</code> et <code>k</code></li>
<li><code>HX</code>, qui prend <code>e</code> en paramètre et qui renvoie la chaîne de caractères hexadécimale <code>e</code> en bytes</li>
</ul>
<p>Si on redéfinit ces deux fonctions pour qu&rsquo;elles soient plus lisibles, on obtient :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">fun_xr</span>(x, k):
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> bytes([c <span style="color:#f92672">^</span> k <span style="color:#66d9ef">for</span> c <span style="color:#f92672">in</span> x])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">fun_hx</span>(e):
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> bytes<span style="color:#f92672">.</span>fromhex(e)
</span></span></code></pre></div><p>Ces fonctions sont appliquées d&rsquo;une certaine manière sur la chaîne suivante :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#e6db74">&#34;204e4f4c0a7549424f4941755a4b59595d45584e0a02656565651a65651a1a651a1a1a656565650a0&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;310200a0a0a0a6565651a65651a65651a1a1a1a1a651a1a0a17711b1b1a0a061c120a06131a0a061f&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;180a06131b0a06121b0a061b1b1b0a061b1a1c0a061b1a130a06121c0a061e190a06121e0a061b181&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;90a061b1a1a0a061c1c0a061c180a061d130a061b181d0a06191e0a061b1a190a061d1f0a061c1e0a&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;061b1a1b0a0612180a061d1b0a061d190a061c1d0a061e1e0a06121e0a0612180a061b1b180a77200&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;a0a0a0a434c0a464f440a026565651a65651a65651a1a1a1a1a651a1a0a030b17464f440a02656565&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;651a65651a1a651a1a1a656565650a0310200a0a0a0a0a0a0a0a584f5e5f58440a6c4b46594f200a0&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;a0a0a4c45580a651a1a651a1a1a1a651a1a1a1a656565650a43440a584b444d4f0a02464f440a0265&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;6565651a65651a1a651a1a1a656565650a030310200a0a0a0a0a0a0a0a434c0a45584e0a026565656&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;51a65651a1a651a1a1a656565650a71651a1a651a1a1a1a651a1a1a1a656565650a770374651a1a65&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;1a1a1a1a651a1a1a1a656565650a0b176565651a65651a65651a1a1a1a1a651a1a0a71651a1a651a1&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;a1a1a651a1a1a1a656565650a7710200a0a0a0a0a0a0a0a0a0a0a0a584f5e5f58440a6c4b46594f20&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;0a0a0a0a584f5e5f58440a7e585f4f2020&#34;</span>
</span></span></code></pre></div><p>On est bien d&rsquo;accord que cette chaîne est ILLISIBLE en l&rsquo;état. Mais si on la décode comme
dans le programme avec les fonctions qu&rsquo;on a redéfinies plus tôt, on obtient :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#75715e"># code = la chaine illisible</span>
</span></span><span style="display:flex;"><span>print(fun_xr(fun_hx(code), <span style="color:#ae81ff">42</span>)<span style="color:#f92672">.</span>decode())
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ce qui renvoi</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_check_password</span> (OOOO0OO00O000OOOO ):
</span></span><span style="display:flex;"><span>  OOO0OO0OO00000O00 <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">110</span>, <span style="color:#ae81ff">68</span>, <span style="color:#ae81ff">90</span>, <span style="color:#ae81ff">52</span>, <span style="color:#ae81ff">91</span>, <span style="color:#ae81ff">81</span>, <span style="color:#ae81ff">111</span>, <span style="color:#ae81ff">106</span>, <span style="color:#ae81ff">109</span>, <span style="color:#ae81ff">86</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">43</span>, <span style="color:#ae81ff">84</span>, <span style="color:#ae81ff">123</span>, <span style="color:#ae81ff">100</span>, <span style="color:#ae81ff">66</span>, <span style="color:#ae81ff">62</span>, <span style="color:#ae81ff">79</span>, <span style="color:#ae81ff">127</span>, <span style="color:#ae81ff">34</span>, <span style="color:#ae81ff">103</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">75</span>, <span style="color:#ae81ff">64</span>, <span style="color:#ae81ff">101</span>, <span style="color:#ae81ff">82</span>, <span style="color:#ae81ff">71</span>, <span style="color:#ae81ff">73</span>, <span style="color:#ae81ff">67</span>, <span style="color:#ae81ff">44</span>, <span style="color:#ae81ff">84</span>, <span style="color:#ae81ff">82</span>, <span style="color:#ae81ff">112</span> 
</span></span><span style="display:flex;"><span>  ]
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> len (OOO0OO0OO00000O00 )<span style="color:#f92672">!=</span>len (OOOO0OO00O000OOOO ):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">False</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> O00O0000O0000OOOO <span style="color:#f92672">in</span> range (len (OOOO0OO00O000OOOO )):
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> ord (OOOO0OO00O000OOOO [O00O0000O0000OOOO ])<span style="color:#f92672">^</span>O00O0000O0000OOOO <span style="color:#f92672">!=</span>OOO0OO0OO00000O00 [O00O0000O0000OOOO ]:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">False</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">True</span>
</span></span></code></pre></div><p>On comprend très vite que cette fonction est la fonction <code>check_password</code> utilisée dans le code principal.
Encore une fois, on essaie de nous rendre la tâche difficile en utilisant des noms de variables
compliqués à lire, mais ce n&rsquo;est pas grave, on va s&rsquo;en sortir :).</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_check_password</span> (s):
</span></span><span style="display:flex;"><span>  code <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">110</span>, <span style="color:#ae81ff">68</span>, <span style="color:#ae81ff">90</span>, <span style="color:#ae81ff">52</span>, <span style="color:#ae81ff">91</span>, <span style="color:#ae81ff">81</span>, <span style="color:#ae81ff">111</span>, <span style="color:#ae81ff">106</span>, <span style="color:#ae81ff">109</span>, <span style="color:#ae81ff">86</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">43</span>, <span style="color:#ae81ff">84</span>, <span style="color:#ae81ff">123</span>, <span style="color:#ae81ff">100</span>, <span style="color:#ae81ff">66</span>, <span style="color:#ae81ff">62</span>, <span style="color:#ae81ff">79</span>, <span style="color:#ae81ff">127</span>, <span style="color:#ae81ff">34</span>, <span style="color:#ae81ff">103</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">75</span>, <span style="color:#ae81ff">64</span>, <span style="color:#ae81ff">101</span>, <span style="color:#ae81ff">82</span>, <span style="color:#ae81ff">71</span>, <span style="color:#ae81ff">73</span>, <span style="color:#ae81ff">67</span>, <span style="color:#ae81ff">44</span>, <span style="color:#ae81ff">84</span>, <span style="color:#ae81ff">82</span>, <span style="color:#ae81ff">112</span> 
</span></span><span style="display:flex;"><span>  ]
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> len(code) <span style="color:#f92672">!=</span> len(s):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">False</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range (len (s)):
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> ord (s[i])<span style="color:#f92672">^</span>i <span style="color:#f92672">!=</span> code[i]:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">False</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">True</span>
</span></span></code></pre></div><p>On arrive un peu plus à comprendre ce que fait la fonction maintenant. Elle vérifie que la chaîne
rentrée en paramètre soit égale à la chaîne <code>code</code> après un XOR avec l&rsquo;index de chaque caractère
de la chaîne. Heureusement pour nous, le XOR est réversible (c&rsquo;est-à-dire que <code>a ^ b = c</code> et
<code>c ^ b = a</code>), donc on peut retrouver la chaîne <code>code</code> en faisant un XOR entre chaque élément
de <code>code</code> et l&rsquo;index de chaque élément.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span>code <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>  <span style="color:#ae81ff">110</span>, <span style="color:#ae81ff">68</span>, <span style="color:#ae81ff">90</span>, <span style="color:#ae81ff">52</span>, <span style="color:#ae81ff">91</span>, <span style="color:#ae81ff">81</span>, <span style="color:#ae81ff">111</span>, <span style="color:#ae81ff">106</span>, <span style="color:#ae81ff">109</span>, <span style="color:#ae81ff">86</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#ae81ff">43</span>, <span style="color:#ae81ff">84</span>, <span style="color:#ae81ff">123</span>, <span style="color:#ae81ff">100</span>, <span style="color:#ae81ff">66</span>, <span style="color:#ae81ff">62</span>, <span style="color:#ae81ff">79</span>, <span style="color:#ae81ff">127</span>, <span style="color:#ae81ff">34</span>, <span style="color:#ae81ff">103</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#ae81ff">75</span>, <span style="color:#ae81ff">64</span>, <span style="color:#ae81ff">101</span>, <span style="color:#ae81ff">82</span>, <span style="color:#ae81ff">71</span>, <span style="color:#ae81ff">73</span>, <span style="color:#ae81ff">67</span>, <span style="color:#ae81ff">44</span>, <span style="color:#ae81ff">84</span>, <span style="color:#ae81ff">82</span>, <span style="color:#ae81ff">112</span> 
</span></span><span style="display:flex;"><span>]
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(len(code)):
</span></span><span style="display:flex;"><span>  code[i] <span style="color:#f92672">=</span> code[i] <span style="color:#f92672">^</span> i
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">&#39;&#39;</span><span style="color:#f92672">.</span>join([chr(c) <span style="color:#66d9ef">for</span> c <span style="color:#f92672">in</span> code]))
</span></span><span style="display:flex;"><span><span style="color:#75715e"># renovoie : nEX7_Time_!_wiL1_n0t_UsE_PY7HOn</span>
</span></span></code></pre></div><p>On a enfin notre mot de passe (wouhou !). On peut maintenant lancer le script principal et
entrer le mot de passe pour obtenir le flag (<code>JDHACK{nEX7_Time_!_wiL1_n0t_UsE_PY7HOn}</code>).</p>
<h2 id="rev-my-snake-iii">Rev My Snake III</h2>
<p>Les sources du challenge sont disponibles <a href="https://github.com/JeanneD-Hack-CTF/JeanneD-Hack-CTF-2025/tree/main/reverse/Rev_My_Snake_III">ici</a>.</p>
<p>Writeup by <a href="https://www.linkedin.com/in/lucas-coussement-73bb0927b">Tourte</a></p>
<h3 id="description-2">Description</h3>
<p>Ce challenge est le troisième et dernier challenge de reverse de la série <strong>&ldquo;Rev my snake&rdquo;</strong>. Il est
classé <strong>moyen</strong> et a fait pleurer quelques larmes de sang à certains.</p>
<h3 id="outils-nécessaires-2">Outils nécessaires</h3>
<ul>
<li>Un éditeur de texte classique</li>
<li>Python (pour pouvoir exécuter le script)</li>
<li>Ghidra (un logiciel de rétro-ingénierie)</li>
</ul>
<h3 id="fichiers-fournis-2">Fichiers fournis</h3>
<ul>
<li><code>chall.py</code> : Le script python à analyser</li>
<li><code>Maze.so</code> : Un fichier additionnel utilisé par <code>chall.py</code></li>
</ul>
<h3 id="résolution-2">Résolution</h3>
<p>Cette fois-ci, contrairement aux autres fois, ce n&rsquo;est pas un mot de passe que <code>chall.py</code> nous
demande, mais de réussir à résoudre un labyrinthe. En analysant le code, on s&rsquo;aperçoit
que <code>chall.py</code> importe le fameux fichier <code>Maze.so</code> qui contient un objet <code>Maze</code> inconnu.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#f92672">import</span> Maze
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">enter_maze</span>():
</span></span><span style="display:flex;"><span>  Maze<span style="color:#f92672">.</span>generate()
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">while</span> <span style="color:#f92672">not</span> Maze<span style="color:#f92672">.</span>is_finished():
</span></span><span style="display:flex;"><span>    dialog(<span style="color:#e6db74">&#39;Maze&#39;</span>, <span style="color:#e6db74">&#39;Where do you like to go?&#39;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>      choice <span style="color:#f92672">=</span> input(<span style="color:#e6db74">&#39;[Jeanne] &#39;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> len(choice) <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#39;up&#39;</span><span style="color:#f92672">.</span>startswith(choice<span style="color:#f92672">.</span>lower()):
</span></span><span style="display:flex;"><span>            Maze<span style="color:#f92672">.</span>up()
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">elif</span> <span style="color:#e6db74">&#39;down&#39;</span><span style="color:#f92672">.</span>startswith(choice<span style="color:#f92672">.</span>lower()):
</span></span><span style="display:flex;"><span>            Maze<span style="color:#f92672">.</span>down()
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">elif</span> <span style="color:#e6db74">&#39;right&#39;</span><span style="color:#f92672">.</span>startswith(choice<span style="color:#f92672">.</span>lower()):
</span></span><span style="display:flex;"><span>            Maze<span style="color:#f92672">.</span>right()
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">elif</span> <span style="color:#e6db74">&#39;left&#39;</span><span style="color:#f92672">.</span>startswith(choice<span style="color:#f92672">.</span>lower()):
</span></span><span style="display:flex;"><span>            Maze<span style="color:#f92672">.</span>left()
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">elif</span> <span style="color:#e6db74">&#39;flag&#39;</span><span style="color:#f92672">.</span>startswith(choice<span style="color:#f92672">.</span>lower()):
</span></span><span style="display:flex;"><span>            Maze<span style="color:#f92672">.</span>flag()
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">except</span> (<span style="color:#a6e22e">EOFError</span>, <span style="color:#a6e22e">KeyboardInterrupt</span>):
</span></span><span style="display:flex;"><span>          show(<span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span>)
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">break</span>
</span></span></code></pre></div><p>C&rsquo;est dans la fonction <code>enter_maze</code> appelée dans la conversation plus bas du fichier qu&rsquo;on
utilise l&rsquo;objet <code>Maze</code>. L&rsquo;objet <code>Maze</code> a l&rsquo;air d&rsquo;avoir plusieurs méthodes. Voici celles
qu&rsquo;on arrive à identifier dans la fonction :</p>
<ul>
<li><code>generate()</code> qui génère le labyrinthe d&rsquo;une manière ou d&rsquo;une autre</li>
<li><code>up()</code> pour aller en haut</li>
<li><code>down()</code> pour aller en bas</li>
<li><code>left()</code> pour aller à gauche</li>
<li><code>right()</code> pour aller à droite</li>
<li><code>flag()</code> sûrement pour récupérer le flag</li>
</ul>
<p>On comprend assez bien que l&rsquo;objectif de ce programme est de nous faire parcourir un
labyrinthe jusqu&rsquo;à un certain endroit où on pourra récupérer le flag. On pourrait
s&rsquo;amuser à tester toutes les possibilités à la main, mais on n&rsquo;a aucune idée de si ce
labyrinthe est vraiment faisable, alors ne nous aventurons pas dans ce genre de solutions.</p>
<p>À la place, ce que nous allons faire, c&rsquo;est ouvrir le fichier <code>Maze.so</code> dans Ghidra pour
tenter de comprendre ce qu&rsquo;il fait vraiment.</p>
<p>Si on cherche dans le <em>symbole tree</em>, on s&rsquo;aperçoit que toutes les méthodes énumérées plus
tôt s&rsquo;y trouvent. On va donc les analyser une à une pour les comprendre.</p>
<p>On remarque en analysant <code>generate()</code> qu&rsquo;elle alloue les ressources nécessaires pour charger
un objet de chiffrement issu de la bibliothèque OpenSSL.</p>
<p>Ensuite, si on analyse les 4 méthodes pour bouger (<em>ici left</em>), on obtient :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">if</span> (((player_x <span style="color:#f92672">-</span> <span style="color:#ae81ff">1U</span> <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0x10</span>) <span style="color:#f92672">&amp;&amp;</span> ((uint)player_y <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0x10</span>)) <span style="color:#f92672">&amp;&amp;</span>
</span></span><span style="display:flex;"><span>  (Maze[(<span style="color:#66d9ef">int</span>)(player_y <span style="color:#f92672">*</span> <span style="color:#ae81ff">0x10</span> <span style="color:#f92672">+</span> (player_x <span style="color:#f92672">-</span> <span style="color:#ae81ff">1U</span>))] <span style="color:#f92672">!=</span> <span style="color:#ae81ff">1</span>)) {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">dialog</span>(<span style="color:#e6db74">&#34;Maze&#34;</span>,<span style="color:#e6db74">&#34;Going left&#34;</span>);
</span></span><span style="display:flex;"><span>  player_x <span style="color:#f92672">=</span> player_x <span style="color:#f92672">+</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">snprintf</span>(buffer,<span style="color:#ae81ff">3</span>,<span style="color:#e6db74">&#34;%x%x&#34;</span>,(ulong)(uint)player_y);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">EVP_DigestUpdate</span>((EVP_MD_CTX <span style="color:#f92672">*</span>)mdctx,buffer,<span style="color:#ae81ff">2</span>);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">dialog</span>(<span style="color:#e6db74">&#34;Maze&#34;</span>,<span style="color:#e6db74">&#34;Cannot move left&#34;</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>On comprend que les conditions pour bouger sont :</p>
<ul>
<li>De savoir si les coordonnées <code>x</code> et <code>y</code> après mouvement sont inférieures à 0x10 (16 en gros)</li>
<li>De savoir si dans le tableau <code>Maze</code> à l&rsquo;indice $x + y \times 16$ la valeur est différente de 1</li>
</ul>
<p>Cette fonction nous apprend plusieurs choses, mais particulièrement qu&rsquo;il existe un tableau <code>Maze</code> rempli avec certaines valeurs.</p>
<p>Maintenant, prenons le temps d&rsquo;analyser la méthode <code>flag</code> :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">if</span> ((Maze[player_y <span style="color:#f92672">*</span> <span style="color:#ae81ff">16</span> <span style="color:#f92672">+</span> player_x] <span style="color:#f92672">==</span> <span style="color:#ae81ff">2</span>) <span style="color:#f92672">&amp;&amp;</span> (flag_is_taken <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>)) {
</span></span><span style="display:flex;"><span>  flag_is_taken <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">EVP_DigestFinal_ex</span>((EVP_MD_CTX <span style="color:#f92672">*</span>)mdctx,md_value,<span style="color:#f92672">&amp;</span>md_len);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">EVP_MD_CTX_free</span>(mdctx);
</span></span><span style="display:flex;"><span>  ctx_00 <span style="color:#f92672">=</span> <span style="color:#a6e22e">EVP_CIPHER_CTX_new</span>();
</span></span><span style="display:flex;"><span>  ctx <span style="color:#f92672">=</span> (EVP_CIPHER_CTX <span style="color:#f92672">*</span>)<span style="color:#a6e22e">EVP_aes_128_cbc</span>();
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">EVP_DecryptInit_ex</span>(ctx_00,(EVP_CIPHER <span style="color:#f92672">*</span>)ctx,(ENGINE <span style="color:#f92672">*</span>)<span style="color:#ae81ff">0x0</span>,md_value,iv);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">EVP_DecryptUpdate</span>(ctx_00,buffer,<span style="color:#f92672">&amp;</span>buffer_len,flag_enc,<span style="color:#ae81ff">48</span>);
</span></span><span style="display:flex;"><span>  iVar1 <span style="color:#f92672">=</span> buffer_len;
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">EVP_DecryptFinal_ex</span>(ctx_00,buffer <span style="color:#f92672">+</span> buffer_len,<span style="color:#f92672">&amp;</span>buffer_len);
</span></span><span style="display:flex;"><span>  buffer[iVar1 <span style="color:#f92672">+</span> buffer_len] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;\0&#39;</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> ((buffer._0_4_ <span style="color:#f92672">==</span> <span style="color:#ae81ff">0x4148444a</span>) <span style="color:#f92672">&amp;&amp;</span> (buffer._4_2_ <span style="color:#f92672">==</span> <span style="color:#ae81ff">0x4b43</span>)) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">dialog</span>(<span style="color:#e6db74">&#34;Maze&#34;</span>,<span style="color:#e6db74">&#34;Here is your flag:&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">dialog</span>(<span style="color:#e6db74">&#34;Maze&#34;</span>,(<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>)buffer);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">dialog</span>(<span style="color:#e6db74">&#34;Maze&#34;</span>,<span style="color:#e6db74">&#34;Mmm, The flag doesn</span><span style="color:#ae81ff">\&#39;</span><span style="color:#e6db74">t seem correct, are you sure you took the right path?&#34;</span>);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Cette méthode nous apprend que la condition pour récupérer le flag est d&rsquo;obtenir
une position qui, dès que l&rsquo;on fait le calcul \(i = y \times 16 + x\), doit avoir <code>Maze[i] = 2</code>.</p>
<p>On s&rsquo;aperçoit aussi que la clé est le résultat de plusieurs opérations cryptographiques
sur le chemin que nous avons parcouru. Nous n&rsquo;avons alors pas d&rsquo;autre choix que de
calculer nous-mêmes ce chemin à partir du labyrinthe en prenant en compte toutes les
règles établies par le code. Pour la suite de ce writeup, je vais utiliser Python,
mais n&rsquo;importe quel langage de programmation pourrait théoriquement faire l&rsquo;affaire.</p>
<p>Avant tout, nous allons récupérer la variable <code>Maze</code> qui contient la &ldquo;carte&rdquo; de ce labyrinthe :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span>Maze <span style="color:#f92672">=</span> [ 
</span></span><span style="display:flex;"><span>  <span style="color:#ae81ff">0x00</span>, <span style="color:#ae81ff">0x00</span>, <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x01</span>, 
</span></span><span style="display:flex;"><span>  <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x01</span>, 
</span></span><span style="display:flex;"><span>  <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x00</span>, <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x00</span>, <span style="color:#ae81ff">0x00</span>, <span style="color:#ae81ff">0x00</span>, <span style="color:#ae81ff">0x00</span>, <span style="color:#ae81ff">0x00</span>, 
</span></span><span style="display:flex;"><span>  <span style="color:#ae81ff">0x00</span>, <span style="color:#ae81ff">0x00</span>, <span style="color:#ae81ff">0x00</span>, <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x00</span>, <span style="color:#ae81ff">0x00</span>, <span style="color:#ae81ff">0x00</span>, <span style="color:#ae81ff">0x01</span>, 
</span></span><span style="display:flex;"><span>  <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x00</span>, <span style="color:#ae81ff">0x00</span>, <span style="color:#ae81ff">0x00</span>, <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x01</span>, 
</span></span><span style="display:flex;"><span>  <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x00</span>, <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x00</span>, <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x00</span>, <span style="color:#ae81ff">0x01</span>, 
</span></span><span style="display:flex;"><span>  <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x00</span>, <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x00</span>, <span style="color:#ae81ff">0x00</span>, <span style="color:#ae81ff">0x00</span>, 
</span></span><span style="display:flex;"><span>  <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x00</span>, <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x00</span>, <span style="color:#ae81ff">0x00</span>, <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x00</span>, <span style="color:#ae81ff">0x01</span>, 
</span></span><span style="display:flex;"><span>  <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x00</span>, <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x00</span>, <span style="color:#ae81ff">0x00</span>, <span style="color:#ae81ff">0x00</span>, <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x00</span>, 
</span></span><span style="display:flex;"><span>  <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x00</span>, <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x00</span>, <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x00</span>, <span style="color:#ae81ff">0x01</span>, 
</span></span><span style="display:flex;"><span>  <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x00</span>, <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x00</span>, <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x00</span>, 
</span></span><span style="display:flex;"><span>  <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x00</span>, <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x00</span>, <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x00</span>, <span style="color:#ae81ff">0x00</span>, <span style="color:#ae81ff">0x01</span>, 
</span></span><span style="display:flex;"><span>  <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x00</span>, <span style="color:#ae81ff">0x00</span>, <span style="color:#ae81ff">0x00</span>, <span style="color:#ae81ff">0x00</span>, <span style="color:#ae81ff">0x00</span>, <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x00</span>, 
</span></span><span style="display:flex;"><span>  <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x00</span>, <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x00</span>, <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x01</span>, 
</span></span><span style="display:flex;"><span>  <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x00</span>, <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x00</span>, 
</span></span><span style="display:flex;"><span>  <span style="color:#ae81ff">0x00</span>, <span style="color:#ae81ff">0x00</span>, <span style="color:#ae81ff">0x00</span>, <span style="color:#ae81ff">0x00</span>, <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x00</span>, <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x01</span>, 
</span></span><span style="display:flex;"><span>  <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x00</span>, <span style="color:#ae81ff">0x00</span>, <span style="color:#ae81ff">0x00</span>, <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x00</span>, <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x01</span>, 
</span></span><span style="display:flex;"><span>  <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x00</span>, <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x01</span>, 
</span></span><span style="display:flex;"><span>  <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x00</span>, <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x00</span>, 
</span></span><span style="display:flex;"><span>  <span style="color:#ae81ff">0x00</span>, <span style="color:#ae81ff">0x00</span>, <span style="color:#ae81ff">0x02</span>, <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x00</span>, <span style="color:#ae81ff">0x00</span>, <span style="color:#ae81ff">0x00</span>, <span style="color:#ae81ff">0x01</span>, 
</span></span><span style="display:flex;"><span>  <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x00</span>, <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x00</span>, <span style="color:#ae81ff">0x00</span>, <span style="color:#ae81ff">0x00</span>, <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x00</span>, 
</span></span><span style="display:flex;"><span>  <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x00</span>, <span style="color:#ae81ff">0x01</span>, 
</span></span><span style="display:flex;"><span>  <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x00</span>, <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x00</span>, <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x00</span>, <span style="color:#ae81ff">0x00</span>, <span style="color:#ae81ff">0x00</span>, 
</span></span><span style="display:flex;"><span>  <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x00</span>, <span style="color:#ae81ff">0x00</span>, <span style="color:#ae81ff">0x00</span>, <span style="color:#ae81ff">0x00</span>, <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x00</span>, <span style="color:#ae81ff">0x01</span>, 
</span></span><span style="display:flex;"><span>  <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x00</span>, <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x00</span>, <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x00</span>, 
</span></span><span style="display:flex;"><span>  <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x00</span>, <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x00</span>, <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x00</span>, <span style="color:#ae81ff">0x01</span>, 
</span></span><span style="display:flex;"><span>  <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x00</span>, <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x00</span>, <span style="color:#ae81ff">0x00</span>, <span style="color:#ae81ff">0x00</span>, <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x00</span>, 
</span></span><span style="display:flex;"><span>  <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x00</span>, <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x00</span>, <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x00</span>, <span style="color:#ae81ff">0x01</span>, 
</span></span><span style="display:flex;"><span>  <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x00</span>, <span style="color:#ae81ff">0x00</span>, <span style="color:#ae81ff">0x00</span>, <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x00</span>, <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x00</span>, 
</span></span><span style="display:flex;"><span>  <span style="color:#ae81ff">0x00</span>, <span style="color:#ae81ff">0x00</span>, <span style="color:#ae81ff">0x00</span>, <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x00</span>, <span style="color:#ae81ff">0x00</span>, <span style="color:#ae81ff">0x00</span>, <span style="color:#ae81ff">0x01</span>, 
</span></span><span style="display:flex;"><span>  <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x01</span>, 
</span></span><span style="display:flex;"><span>  <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x01</span> 
</span></span><span style="display:flex;"><span>]
</span></span></code></pre></div><p>C&rsquo;est facilement réalisable en faisant un double clic sur la variable dans la &ldquo;preview C&rdquo;
de Ghidra, puis en sélectionnant la zone mémoire dans la fenêtre &ldquo;listing&rdquo; (qui montre le
code assembleur), puis en faisant clic gauche &gt; copy special puis en sélectionnant le
format cible (ici, Python list).</p>
<p>Voici le code Python qui permettra de résoudre ce challenge.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#f92672">import</span> Maze
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MazeSolver</span>:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">def</span> __init__(self):
</span></span><span style="display:flex;"><span>    self<span style="color:#f92672">.</span>Maze <span style="color:#f92672">=</span> [ <span style="color:#f92672">...</span> ]
</span></span><span style="display:flex;"><span>    self<span style="color:#f92672">.</span>x <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    self<span style="color:#f92672">.</span>y <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">solve_maze</span>(self):
</span></span><span style="display:flex;"><span>      stack <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>      visited <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>      move_found <span style="color:#f92672">=</span> <span style="color:#66d9ef">False</span>
</span></span><span style="display:flex;"><span>      new_x <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>x
</span></span><span style="display:flex;"><span>      new_y <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>y
</span></span><span style="display:flex;"><span>      count <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">while</span> <span style="color:#66d9ef">True</span>:
</span></span><span style="display:flex;"><span>        move_found <span style="color:#f92672">=</span> <span style="color:#66d9ef">False</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> x, y, label <span style="color:#f92672">in</span> [(<span style="color:#ae81ff">0</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, Maze<span style="color:#f92672">.</span>up), (<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>, Maze<span style="color:#f92672">.</span>down), (<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, Maze<span style="color:#f92672">.</span>left), (<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, Maze<span style="color:#f92672">.</span>right)]:
</span></span><span style="display:flex;"><span>          new_x <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>x <span style="color:#f92672">+</span> x
</span></span><span style="display:flex;"><span>          new_y <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>y <span style="color:#f92672">+</span> y
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">if</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">&lt;=</span> new_x <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">16</span> <span style="color:#f92672">and</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">&lt;=</span> new_y <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">16</span> <span style="color:#f92672">and</span> self<span style="color:#f92672">.</span>Maze[new_y <span style="color:#f92672">*</span> <span style="color:#ae81ff">16</span> <span style="color:#f92672">+</span> new_x] <span style="color:#f92672">!=</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">and</span> (new_x, new_y) <span style="color:#f92672">not</span> <span style="color:#f92672">in</span> visited:
</span></span><span style="display:flex;"><span>            stack<span style="color:#f92672">.</span>append((self<span style="color:#f92672">.</span>x, self<span style="color:#f92672">.</span>y, label))
</span></span><span style="display:flex;"><span>            visited<span style="color:#f92672">.</span>append((self<span style="color:#f92672">.</span>x, self<span style="color:#f92672">.</span>y))
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>x <span style="color:#f92672">=</span> new_x
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>y <span style="color:#f92672">=</span> new_y
</span></span><span style="display:flex;"><span>            move_found <span style="color:#f92672">=</span> <span style="color:#66d9ef">True</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> move_found:
</span></span><span style="display:flex;"><span>              <span style="color:#66d9ef">if</span> len(stack) <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>                visited<span style="color:#f92672">.</span>append((self<span style="color:#f92672">.</span>x, self<span style="color:#f92672">.</span>y))
</span></span><span style="display:flex;"><span>                self<span style="color:#f92672">.</span>x, self<span style="color:#f92672">.</span>y, _ <span style="color:#f92672">=</span> stack<span style="color:#f92672">.</span>pop()
</span></span><span style="display:flex;"><span>                count <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>Maze[self<span style="color:#f92672">.</span>y <span style="color:#f92672">*</span> <span style="color:#ae81ff">16</span> <span style="color:#f92672">+</span> self<span style="color:#f92672">.</span>x] <span style="color:#f92672">==</span> <span style="color:#ae81ff">2</span>:
</span></span><span style="display:flex;"><span>              print(<span style="color:#e6db74">&#34;FLAG FOUND&#34;</span>)
</span></span><span style="display:flex;"><span>              <span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> x, y, label <span style="color:#f92672">in</span> stack:
</span></span><span style="display:flex;"><span>          label()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> stack
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Maze<span style="color:#f92672">.</span>generate()
</span></span><span style="display:flex;"><span>solver <span style="color:#f92672">=</span> MazeSolver()
</span></span><span style="display:flex;"><span>solver<span style="color:#f92672">.</span>solve_maze()
</span></span><span style="display:flex;"><span>Maze<span style="color:#f92672">.</span>flag()
</span></span></code></pre></div><p>Ce code utilise un algorithme de backtracking pour parcourir tous les chemins possibles jusqu&rsquo;à
arriver au flag. Une fois le chemin trouvé, il exécute les méthodes de <code>Maze</code> du chemin dans
l&rsquo;ordre et résout le challenge. L&rsquo;exécution du code se fait en plusieurs dizaines de secondes.</p>
<p>Une autre manière de résoudre le challenge serait de reconstruire le flag en copiant les
mécanismes cryptographiques employés dans le programme, mais cela nous demanderait un
travail supplémentaire. Pour ceux qui aimeraient explorer cette solution, vous constaterez
que le flag se trouve dans le code sous le nom de <code>flag_enc</code> et qu&rsquo;il est chiffré avec
AES-128-CBC. Le IV est donné dans la méthode <code>flag</code> (&ldquo;1234567887654321&rdquo;). La clé n&rsquo;est
autre que les coordonnées <code>y</code> en base 16 (ou <code>y</code> et <code>x</code> selon la direction) chiffrées
en MD5 durant votre parcours.</p>
<p>Vous devrez retrouver ceci :</p>
<pre tabindex="0"><code>JDHACK{My_N4m3_1s_P13rr3_C4uch0n}
</code></pre><h2 id="ornithorynque">ORnithorynque</h2>
<p>Les sources du challenge sont disponibles <a href="https://github.com/JeanneD-Hack-CTF/JeanneD-Hack-CTF-2025/tree/main/reverse/ORnithorynque">ici</a>.</p>
<blockquote>
<p>La résistance vous a convié à une réunion top secrète ! Mais l&rsquo;emplacement est gardé secret lui aussi&hellip; À vous de le découvrir.</p></blockquote>
<p>Ce challenge est un challenge facile permettant de s&rsquo;entraîner à reverse des programmes compilés
avant d&rsquo;attaquer d&rsquo;autres challenges plus complexes. On commence par ouvrir le programme dans
Ghidra, celui-ci se résume à deux fonctions : <code>main</code> et <code>flagxor</code> :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>(<span style="color:#66d9ef">void</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">printf</span>(<span style="color:#e6db74">&#34;See you at this location : &#34;</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">flagxor</span>();
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">flagxor</span>(<span style="color:#66d9ef">void</span>) {
</span></span><span style="display:flex;"><span>  byte buffer [<span style="color:#ae81ff">64</span>];
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">int</span> key [<span style="color:#ae81ff">39</span>];
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">int</span> size;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">int</span> k;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">int</span> j;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">int</span> ptr;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">int</span> i;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  key[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x4b</span>;
</span></span><span style="display:flex;"><span>  key[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x45</span>;
</span></span><span style="display:flex;"><span>  key[<span style="color:#ae81ff">2</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x49</span>;
</span></span><span style="display:flex;"><span>  key[<span style="color:#ae81ff">3</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x42</span>;
</span></span><span style="display:flex;"><span>  key[<span style="color:#ae81ff">4</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x44</span>;
</span></span><span style="display:flex;"><span>  key[<span style="color:#ae81ff">5</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x4c</span>;
</span></span><span style="display:flex;"><span>  key[<span style="color:#ae81ff">6</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x7c</span>;
</span></span><span style="display:flex;"><span>  key[<span style="color:#ae81ff">7</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x55</span>;
</span></span><span style="display:flex;"><span>  key[<span style="color:#ae81ff">8</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x70</span>;
</span></span><span style="display:flex;"><span>  key[<span style="color:#ae81ff">9</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x4c</span>;
</span></span><span style="display:flex;"><span>  key[<span style="color:#ae81ff">10</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x5a</span>;
</span></span><span style="display:flex;"><span>  key[<span style="color:#ae81ff">0xb</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x70</span>;
</span></span><span style="display:flex;"><span>  key[<span style="color:#ae81ff">0xc</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x60</span>;
</span></span><span style="display:flex;"><span>  key[<span style="color:#ae81ff">0xd</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x54</span>;
</span></span><span style="display:flex;"><span>  key[<span style="color:#ae81ff">0xe</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x69</span>;
</span></span><span style="display:flex;"><span>  key[<span style="color:#ae81ff">0xf</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x4a</span>;
</span></span><span style="display:flex;"><span>  key[<span style="color:#ae81ff">0x10</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x43</span>;
</span></span><span style="display:flex;"><span>  key[<span style="color:#ae81ff">0x11</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x76</span>;
</span></span><span style="display:flex;"><span>  key[<span style="color:#ae81ff">0x12</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x5a</span>;
</span></span><span style="display:flex;"><span>  key[<span style="color:#ae81ff">0x13</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x62</span>;
</span></span><span style="display:flex;"><span>  key[<span style="color:#ae81ff">0x14</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x7e</span>;
</span></span><span style="display:flex;"><span>  key[<span style="color:#ae81ff">0x15</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x52</span>;
</span></span><span style="display:flex;"><span>  key[<span style="color:#ae81ff">0x16</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x52</span>;
</span></span><span style="display:flex;"><span>  key[<span style="color:#ae81ff">0x17</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x52</span>;
</span></span><span style="display:flex;"><span>  key[<span style="color:#ae81ff">0x18</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x52</span>;
</span></span><span style="display:flex;"><span>  key[<span style="color:#ae81ff">0x19</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x52</span>;
</span></span><span style="display:flex;"><span>  key[<span style="color:#ae81ff">0x1a</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x52</span>;
</span></span><span style="display:flex;"><span>  key[<span style="color:#ae81ff">0x1b</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x52</span>;
</span></span><span style="display:flex;"><span>  key[<span style="color:#ae81ff">0x1c</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x52</span>;
</span></span><span style="display:flex;"><span>  key[<span style="color:#ae81ff">0x1d</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x52</span>;
</span></span><span style="display:flex;"><span>  key[<span style="color:#ae81ff">0x1e</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x52</span>;
</span></span><span style="display:flex;"><span>  key[<span style="color:#ae81ff">0x1f</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x52</span>;
</span></span><span style="display:flex;"><span>  key[<span style="color:#ae81ff">0x20</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x52</span>;
</span></span><span style="display:flex;"><span>  key[<span style="color:#ae81ff">0x21</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x52</span>;
</span></span><span style="display:flex;"><span>  key[<span style="color:#ae81ff">0x22</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x52</span>;
</span></span><span style="display:flex;"><span>  key[<span style="color:#ae81ff">0x23</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x52</span>;
</span></span><span style="display:flex;"><span>  key[<span style="color:#ae81ff">0x24</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x52</span>;
</span></span><span style="display:flex;"><span>  size <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x25</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">for</span> (i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> size; i <span style="color:#f92672">=</span> i <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>) {
</span></span><span style="display:flex;"><span>    key[i] <span style="color:#f92672">=</span> key[i] <span style="color:#f92672">+</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  size <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x15</span>;
</span></span><span style="display:flex;"><span>  ptr <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">for</span> (j <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; j <span style="color:#f92672">&lt;</span> size; j <span style="color:#f92672">=</span> j <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>) {
</span></span><span style="display:flex;"><span>    buffer[ptr] <span style="color:#f92672">=</span> (byte)key[j] <span style="color:#f92672">^</span> <span style="color:#ae81ff">3</span>;
</span></span><span style="display:flex;"><span>    ptr <span style="color:#f92672">=</span> ptr <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">for</span> (k <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; k <span style="color:#f92672">&lt;</span> size; k <span style="color:#f92672">=</span> k <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>) {
</span></span><span style="display:flex;"><span>    buffer[k] <span style="color:#f92672">=</span> buffer[k] <span style="color:#f92672">^</span> <span style="color:#ae81ff">6</span>;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  buffer[size] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">puts</span>((<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>)buffer);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Lorsque l&rsquo;on exécute le programme, on obtient :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ ./ORnithorynque
</span></span><span style="display:flex;"><span>See you at this location : OAMDFN~QjN<span style="color:#ae81ff">\j</span>ZVmLGp<span style="color:#ae81ff">\d</span>x
</span></span></code></pre></div><p>On comprend alors que le flag est &ldquo;chiffré&rdquo; à l&rsquo;aide de la clé key. Afin de le retrouver,
il faut effectuer les opérations dans le sens inverse.
Pour cela, on utilise le script suivant :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">main</span>():
</span></span><span style="display:flex;"><span>  encrypted_flag <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;OAMDFN~QjN\jZVmLGp\dx&#34;</span>
</span></span><span style="display:flex;"><span>  decrypted_flag <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">for</span> c <span style="color:#f92672">in</span> encrypted_flag:
</span></span><span style="display:flex;"><span>    decrypted_char <span style="color:#f92672">=</span> chr((ord(c) <span style="color:#f92672">^</span> <span style="color:#ae81ff">6</span>) <span style="color:#f92672">^</span> <span style="color:#ae81ff">3</span>)
</span></span><span style="display:flex;"><span>    decrypted_flag <span style="color:#f92672">+=</span> decrypted_char
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    print(decrypted_flag)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;__main__&#39;</span>:
</span></span><span style="display:flex;"><span>  main()
</span></span></code></pre></div><p>En exécutant ce script, on obtient le flag : <code>JDHACK{ToKYo_ShIBuYa}</code>.</p>
<h2 id="next-level">Next Level</h2>
<p>Les sources du challenge sont disponibles <a href="https://github.com/JeanneD-Hack-CTF/JeanneD-Hack-CTF-2025/tree/main/reverse/Next_Level">ici</a>.</p>
<blockquote>
<p>Alors que vous arpentez les rues de la ville, votre attention est attirée par un programme étrange qui semble se répéter sans fin.
La lumière bleue d&rsquo;un écran se projette dans l&rsquo;obscurité et vos yeux sont surpris de constater que le contenu affiché n&rsquo;a pas
changé depuis des minutes. Le programme vous demande un mot de passe.</p>
<p>Le programme est un puzzle complexe qui semblent se dérouler sans fin dans une boucle. Vous devrez découvrir comment interagir
avec le programme pour trouver la sortie du cycle et trouver le mot de passe.</p></blockquote>
<p><em>Note</em> : Ce challenge est grandement inspiré de l&rsquo;excellent challenge du 404CTF de 2022 : introspection.</p>
<p>Le principe de ce challenge est celui des poupées russes, un programme imbriqué dans un programme.
Pour mieux comprendre, on commence par regarder la fonction <code>main</code> :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>(<span style="color:#66d9ef">int</span> argc, <span style="color:#66d9ef">char</span> <span style="color:#f92672">**</span>argv, <span style="color:#66d9ef">char</span> <span style="color:#f92672">**</span>environ) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">int</span> iVar1;
</span></span><span style="display:flex;"><span>  ulong uVar2;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (argc <span style="color:#f92672">==</span> <span style="color:#ae81ff">2</span>) {
</span></span><span style="display:flex;"><span>    uVar2 <span style="color:#f92672">=</span> <span style="color:#a6e22e">check_password</span>(<span style="color:#ae81ff">2</span>,argv,environ);
</span></span><span style="display:flex;"><span>    iVar1 <span style="color:#f92672">=</span> (<span style="color:#66d9ef">int</span>)uVar2;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (iVar1 <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">puts</span>(<span style="color:#e6db74">&#34;Wrong password&#34;</span>);
</span></span><span style="display:flex;"><span>      iVar1 <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">0x2a</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">printf</span>(<span style="color:#e6db74">&#34;Usage: %s &lt;password&gt;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>,<span style="color:#f92672">*</span>argv);
</span></span><span style="display:flex;"><span>    iVar1 <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">0x2a</span>;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> iVar1;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Cette fonction ce contente d&rsquo;appelé <code>check_password</code> (renommer à partir des chaînes utilisé).
Cette fonction possède le code suivant:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>ulong <span style="color:#a6e22e">check_password</span>(undefined8 param_1,<span style="color:#66d9ef">char</span> <span style="color:#f92672">**</span>argv,<span style="color:#66d9ef">char</span> <span style="color:#f92672">**</span>env) {
</span></span><span style="display:flex;"><span>  __pid_t _Var1;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">int</span> fd;
</span></span><span style="display:flex;"><span>  ulong uVar2;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  _Var1 <span style="color:#f92672">=</span> <span style="color:#a6e22e">fork</span>();
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (_Var1 <span style="color:#f92672">!=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (_Var1 <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// Parent
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#a6e22e">wait</span>((<span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>)<span style="color:#ae81ff">0x0</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Child
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    uVar2 <span style="color:#f92672">=</span> <span style="color:#a6e22e">ptrace</span>(PTRACE_TRACEME,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> ((<span style="color:#66d9ef">int</span>)uVar2 <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>) {
</span></span><span style="display:flex;"><span>      fd <span style="color:#f92672">=</span> <span style="color:#a6e22e">memfd_create</span>(<span style="color:#e6db74">&#34;&#34;</span>,<span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (fd <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">1</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> uVar2 <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xffffffff</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">write</span>(fd,<span style="color:#f92672">&amp;</span>DAT_001040a0,(ulong)DAT_00104080);
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">fexecve</span>(fd,argv,env);
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">return</span> uVar2 <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xffffffff</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0xffffffd6</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>On peut voir que la fonction crée un nouveau processus via l&rsquo;appel à <code>fork()</code> puis attend que le
processus fils se termine. Dans le fils, on utilise <code>ptrace</code> afin d&rsquo;essayer d&rsquo;empêcher qu&rsquo;un
debugger comme GDB soit attaché. Enfin, le programme appelle les fonctions suivantes :</p>
<ol>
<li><code>memfd_create</code> : Permet de créer un fichier en RAM.</li>
<li><code>write</code> : Écrit des données dans le fichier.</li>
<li><code>fexecve</code> : Exécute le fichier en RAM en passant les arguments reçus en paramètre de <code>check_password</code>.</li>
</ol>
<p>Si on examine les données qui sont écrites, on peut voir ceci :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>DAT_001040a0                XREF[<span style="color:#ae81ff">1</span>]<span style="color:#f92672">:</span>     check_password:<span style="color:#ae81ff">00101250</span>(<span style="color:#f92672">*</span>)  
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">001040</span>a0 <span style="color:#ae81ff">7f</span>              <span style="color:#f92672">??</span>         <span style="color:#ae81ff">7F</span>h    <span style="color:#960050;background-color:#1e0010"></span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">001040</span>a1 <span style="color:#ae81ff">45</span>              <span style="color:#f92672">??</span>         <span style="color:#ae81ff">45</span>h    E
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">001040</span>a2 <span style="color:#ae81ff">4</span>c              <span style="color:#f92672">??</span>         <span style="color:#ae81ff">4</span>Ch    L
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">001040</span>a3 <span style="color:#ae81ff">46</span>              <span style="color:#f92672">??</span>         <span style="color:#ae81ff">46</span>h    F
</span></span><span style="display:flex;"><span>...
</span></span></code></pre></div><p>On comprend qu&rsquo;il s&rsquo;agit d&rsquo;un programme exécutable Linux grâce à la signature
<code>\x7FELF</code>. Si on extrait ce programme et que l&rsquo;on analyse ce dernier, on constate
une structure identique à la précédente. On comprend que l&rsquo;analyse manuelle de ce
programme risque de prendre du temps et qu&rsquo;il serait plus intéressant de scripter
la résolution. Pour cela, il existe plusieurs méthodes :</p>
<ul>
<li>Utiliser <code>LD_PRELOAD</code> afin de modifier le comportement du programme.</li>
<li>Utiliser une approche statique grâce à un script Ghidra ou à la bibliothèque
<a href="https://lief.re">LIEF</a>.</li>
</ul>
<p>Je vous propose la première solution car il s&rsquo;agit de la plus rapide à mettre
en place :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#75715e">/*
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * Compile with: gcc -shared -fPIC -o hook.so hook.c -ldl
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#define _GNU_SOURCE
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;dlfcn.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;fcntl.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;unistd.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;stdio.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;string.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">ssize_t</span> <span style="color:#a6e22e">write</span>(<span style="color:#66d9ef">int</span> fd, <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>buf, <span style="color:#66d9ef">size_t</span> count) {
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Resolve bind if necessary
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">ssize_t</span> (<span style="color:#f92672">*</span>_write)(<span style="color:#66d9ef">int</span>, <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>, <span style="color:#66d9ef">size_t</span>) <span style="color:#f92672">=</span> NULL;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (_write <span style="color:#f92672">==</span> NULL) {
</span></span><span style="display:flex;"><span>    _write <span style="color:#f92672">=</span> <span style="color:#a6e22e">dlsym</span>(RTLD_NEXT, <span style="color:#e6db74">&#34;write&#34;</span>);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Generate a different filename for each level
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">char</span> filename[<span style="color:#ae81ff">1024</span>] <span style="color:#f92672">=</span> { <span style="color:#ae81ff">0</span> };
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">snprintf</span>(filename, <span style="color:#ae81ff">1024</span>, <span style="color:#e6db74">&#34;a.out.%d&#34;</span>, <span style="color:#a6e22e">getpid</span>());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Open the file to write the copied data
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">int</span> copy <span style="color:#f92672">=</span> <span style="color:#a6e22e">open</span>(filename, O_WRONLY <span style="color:#f92672">|</span> O_CREAT, <span style="color:#ae81ff">0644</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (copy <span style="color:#f92672">==</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Write the data to the copy file
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">ssize_t</span> written <span style="color:#f92672">=</span> <span style="color:#a6e22e">_write</span>(copy, buf, count);
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Close the copy file
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#a6e22e">close</span>(copy);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Call the original write function
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">_write</span>(fd, buf, count);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>On peut ensuite compiler et utiliser notre hook comme ceci :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ gcc -shared -fPIC -o hook.so hook.c -ldl
</span></span><span style="display:flex;"><span>LD_PRELOAD<span style="color:#f92672">=</span>./hook.so ./next_level aaaaaaaa
</span></span></code></pre></div><p>On obtient alors une centaine de programmes <code>a.out.XXXX</code>. Il suffit de prendre le dernier
programme généré, c&rsquo;est-à-dire celui avec le numéro de PID le plus grand. Une fois ouvert dans Ghidra, on obtient :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">check_password</span>(<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>param_1) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">long</span> lVar1;
</span></span><span style="display:flex;"><span>  byte <span style="color:#f92672">*</span>pbVar2;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">char</span> cVar3;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">int</span> iVar4;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">bool</span> bVar5;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">bool</span> bVar6;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  lVar1 <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x19</span>;
</span></span><span style="display:flex;"><span>  bVar5 <span style="color:#f92672">=</span> <span style="color:#f92672">&amp;</span>stack0xfffffffffffffff0 <span style="color:#f92672">&lt;</span> (undefined1 <span style="color:#f92672">*</span>)<span style="color:#ae81ff">0x8</span>;
</span></span><span style="display:flex;"><span>  bVar6 <span style="color:#f92672">=</span> <span style="color:#f92672">&amp;</span>stack0x00000000 <span style="color:#f92672">==</span> (undefined1 <span style="color:#f92672">*</span>)<span style="color:#ae81ff">0x18</span>;
</span></span><span style="display:flex;"><span>  pbVar2 <span style="color:#f92672">=</span> (byte <span style="color:#f92672">*</span>)<span style="color:#e6db74">&#34;y0u_r34ch_7h3_l457_l3v3l!&#34;</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">do</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (lVar1 <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>) <span style="color:#66d9ef">break</span>;
</span></span><span style="display:flex;"><span>    lVar1 <span style="color:#f92672">=</span> lVar1 <span style="color:#f92672">+</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>    bVar5 <span style="color:#f92672">=</span> (byte)<span style="color:#f92672">*</span>param_1 <span style="color:#f92672">&lt;</span> <span style="color:#f92672">*</span>pbVar2;
</span></span><span style="display:flex;"><span>    bVar6 <span style="color:#f92672">=</span> <span style="color:#f92672">*</span>param_1 <span style="color:#f92672">==</span> <span style="color:#f92672">*</span>pbVar2;
</span></span><span style="display:flex;"><span>    param_1 <span style="color:#f92672">=</span> (<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>)((byte <span style="color:#f92672">*</span>)param_1 <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>    pbVar2 <span style="color:#f92672">=</span> pbVar2 <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>  } <span style="color:#66d9ef">while</span> (bVar6);
</span></span><span style="display:flex;"><span>  cVar3 <span style="color:#f92672">=</span> (<span style="color:#f92672">!</span>bVar5 <span style="color:#f92672">&amp;&amp;</span> <span style="color:#f92672">!</span>bVar6) <span style="color:#f92672">-</span> bVar5;
</span></span><span style="display:flex;"><span>  iVar4 <span style="color:#f92672">=</span> (<span style="color:#66d9ef">int</span>)cVar3;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (cVar3 <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;\0&#39;</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">puts</span>(<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">Congratulations, you can validate with:&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">printf</span>(<span style="color:#e6db74">&#34;JDHACK{%s}</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>,<span style="color:#e6db74">&#34;y0u_r34ch_7h3_l457_l3v3l!&#34;</span>);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>    iVar4 <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">0x2a</span>;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> iVar4;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>On peut voir que le flag est directement écrit en clair dans ce programme (il était donc possible de
le récupérer directement avec <code>strings</code>, oups). On obtient alors le flag : <code>JDHACK{y0u_r34ch_7h3_l457_l3v3l!}</code></p>
<h2 id="kudo">Kudo</h2>
<p>Les sources du challenge sont disponibles <a href="https://github.com/JeanneD-Hack-CTF/JeanneD-Hack-CTF-2025/tree/main/reverse/Kudo">ici</a>.</p>
<p>Writeup by <a href="https://www.linkedin.com/in/lucas-coussement-73bb0927b">Tourte</a></p>
<h2 id="description-3">Description</h2>
<p>Dans ce challenge, nous sommes face à une application qui est une réimplémentation de <code>sudo</code>.
L&rsquo;objectif est de trouver le mot de passe de l&rsquo;utilisateur <code>Jeanne</code> en comprenant comment
l&rsquo;exécutable <code>kudo</code> fonctionne.</p>
<h2 id="outils-nécessaires-3">Outils nécessaires</h2>
<ul>
<li>Un éditeur de texte classique</li>
<li>Python (ou un autre langage de scripting pour générer la solution)</li>
<li>Ghidra (ou un autre désassembleur comme IDA)</li>
</ul>
<h2 id="fichiers-fournis-3">Fichiers fournis</h2>
<ul>
<li><code>kudo</code> : L&rsquo;exécutable à analyser</li>
<li><code>shadow</code> : Le fichier contenant la liste des utilisateurs et leur mot de passe hashé</li>
</ul>
<h2 id="résolution-3">Résolution</h2>
<p>Pour résoudre ce challenge, nous allons devoir comprendre comment fonctionne l&rsquo;exécutable <code>kudo</code> et comment
il vérifie le mot de passe de l&rsquo;utilisateur <code>Jeanne</code>.</p>
<p>Pour cela, nous allons commencer par lancer une fois l&rsquo;exécutable pour voir comment il fonctionne.</p>
<h3 id="analyse-de-lexécutable">Analyse de l&rsquo;exécutable</h3>
<p>Au lancement de l&rsquo;exécutable, nous avons un très bel ASCII art représentant le titre de l&rsquo;exécutable
ainsi qu&rsquo;une demande d&rsquo;input <code>Enter your username:</code>. Nous devinons donc que c&rsquo;est ici que nous allons
devoir entrer &ldquo;Jeanne&rdquo;. Une fois cela fait, l&rsquo;exécutable nous demande de rentrer un mot de passe.
En entrant quelque chose au hasard, nous avons un message d&rsquo;erreur composé d&rsquo;une ligne <code>DEBUG</code> et
de ce qui semble être une chaîne de caractères en base64. Sûrement le hash du mot de passe que
nous venons de rentrer. Cette information pourrait être utile par la suite pour trouver la
solution finale de ce challenge.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>./kudo
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>__    __                 __
</span></span><span style="display:flex;"><span>|  <span style="color:#ae81ff">\ </span> /  <span style="color:#ae81ff">\ </span>              |  <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>| $$ /  $$__    __   ____| $$  ______
</span></span><span style="display:flex;"><span>| $$/  $$|  <span style="color:#ae81ff">\ </span> |  <span style="color:#ae81ff">\ </span>/      $$ /      <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>| $$  $$ | $$  | $$|  $$$$$$$|  $$$$$$<span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>| $$$$$<span style="color:#ae81ff">\ </span>| $$  | $$| $$  | $$| $$  | $$
</span></span><span style="display:flex;"><span>| $$ <span style="color:#ae81ff">\$</span>$<span style="color:#ae81ff">\|</span> $$__/ $$| $$__| $$| $$__/ $$
</span></span><span style="display:flex;"><span>| $$  <span style="color:#ae81ff">\$</span>$<span style="color:#ae81ff">\\</span>$$    $$ <span style="color:#ae81ff">\$</span>$    $$ <span style="color:#ae81ff">\$</span>$    $$
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">\$</span>$   <span style="color:#ae81ff">\$</span>$ <span style="color:#ae81ff">\$</span>$$$$$   <span style="color:#ae81ff">\$</span>$$$$$$  <span style="color:#ae81ff">\$</span>$$$$$
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Strong login prompt <span style="color:#f92672">(</span>better than sudo<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Enter your username: Jeanne
</span></span><span style="display:flex;"><span>Enter your password: Jeanne
</span></span><span style="display:flex;"><span>DEBUG: 7a6fYKrSp855RXHs//ziXw<span style="color:#f92672">==</span>
</span></span><span style="display:flex;"><span>Authentification failure
</span></span></code></pre></div><h3 id="décompilation-de-lexécutable">Décompilation de l&rsquo;exécutable</h3>
<p>L&rsquo;exécutable <code>kudo</code> est un binaire, nous allons donc devoir le décompiler pour comprendre comment fonctionne le système de vérification de mot de passe.</p>
<p>En regardant la fonction <code>main</code> de l&rsquo;exécutable, on peut remarquer une fonction très intéressante <code>login</code>.
On comprend son utilité rien qu&rsquo;en regardant le nom. Cette fonction contient également une autre
fonction encore plus intéressante, <code>compare_password</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">compare_password</span>(<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>username,<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>password,<span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>hash) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">int</span> extraout_EAX;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">int</span> r;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">size_t</span> sVar1;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">size_t</span> l;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>encoded;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">char</span> local_1048 [<span style="color:#ae81ff">2048</span>];
</span></span><span style="display:flex;"><span>  undefined1 local_848 [<span style="color:#ae81ff">1024</span>];
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">char</span> buffer [<span style="color:#ae81ff">1024</span>];
</span></span><span style="display:flex;"><span>  ulong k;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">size_t</span> j;
</span></span><span style="display:flex;"><span>  ulong i;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  sVar1 <span style="color:#f92672">=</span> <span style="color:#a6e22e">strlen</span>(password);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">for</span> (i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; j <span style="color:#f92672">=</span> sVar1, i <span style="color:#f92672">&lt;</span> sVar1; i <span style="color:#f92672">=</span> i <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (password[i] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;_&#39;</span>) {
</span></span><span style="display:flex;"><span>      password[i] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;/&#39;</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (password[i] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;/&#39;</span>) {
</span></span><span style="display:flex;"><span>      password[i] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;_&#39;</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (password[i] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;+&#39;</span>) {
</span></span><span style="display:flex;"><span>      password[i] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;-&#39;</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (password[i] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;-&#39;</span>) {
</span></span><span style="display:flex;"><span>      password[i] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;+&#39;</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (password[i] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;!&#39;</span>) {
</span></span><span style="display:flex;"><span>      password[i] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;?&#39;</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (password[i] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;?&#39;</span>) {
</span></span><span style="display:flex;"><span>      password[i] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;!&#39;</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (password[i] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;#&#39;</span>) {
</span></span><span style="display:flex;"><span>      password[i] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;@&#39;</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (password[i] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;@&#39;</span>) {
</span></span><span style="display:flex;"><span>      password[i] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;#&#39;</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">for</span> (; j <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0</span>; j <span style="color:#f92672">=</span> j <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>) {
</span></span><span style="display:flex;"><span>    password[j] <span style="color:#f92672">=</span> password[j] <span style="color:#f92672">^</span> (byte)j;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">hexencode</span>(password,sVar1,buffer,<span style="color:#ae81ff">0x400</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">for</span> (k <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; k <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0x20</span>; k <span style="color:#f92672">=</span> k <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>) {
</span></span><span style="display:flex;"><span>    l <span style="color:#f92672">=</span> <span style="color:#a6e22e">strlen</span>(username);
</span></span><span style="display:flex;"><span>    local_1048[k] <span style="color:#f92672">=</span> username[k <span style="color:#f92672">%</span> l];
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">encrypt</span>(buffer,(<span style="color:#66d9ef">int</span>)(sVar1 <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">1</span>));
</span></span><span style="display:flex;"><span>  encoded <span style="color:#f92672">=</span> (<span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>)<span style="color:#a6e22e">base64_encode</span>(local_848,(<span style="color:#66d9ef">long</span>)extraout_EAX);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (encoded <span style="color:#f92672">==</span> (<span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>)<span style="color:#ae81ff">0x0</span>) {
</span></span><span style="display:flex;"><span>    r <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">fprintf</span>(stderr,<span style="color:#e6db74">&#34;DEBUG: %s</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>,encoded);
</span></span><span style="display:flex;"><span>    r <span style="color:#f92672">=</span> <span style="color:#a6e22e">memcmp</span>(encoded,hash,<span style="color:#ae81ff">0x18</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">free</span>(encoded);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (r <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>) {
</span></span><span style="display:flex;"><span>      r <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>      r <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> r;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Cette fonction prend en entrée trois arguments :</p>
<ul>
<li><code>username</code> : le nom de l&rsquo;utilisateur</li>
<li><code>input_password</code> : le mot de passe rentré par l&rsquo;utilisateur</li>
<li><code>hash</code> : le hash du mot de passe de l&rsquo;utilisateur</li>
</ul>
<p>Cette fonction modifie le mot de passe de plusieurs manières pour
générer un hash. Ce hash sera ensuite comparé avec celui présent dans
le fichier <code>shadow</code> fourni avec l&rsquo;exécutable.</p>
<p>Les différentes étapes de la modification du mot de passe sont les suivantes :</p>
<ul>
<li>On remplace certains caractères par d&rsquo;autres.</li>
<li>On effectue un XOR sur chaque caractère du mot de passe avec l&rsquo;indice du caractère dans le mot de passe.</li>
<li>On transforme le mot de passe en hexadécimal.</li>
<li>On chiffre le mot de passe à l&rsquo;aide d&rsquo;une autre fonction <code>encrypt</code> que nous verrons plus tard.</li>
<li>On encode le mot de passe en base64.</li>
</ul>
<p>Les caractères qui sont remplacés sont les suivants :</p>
<ul>
<li>&lsquo;_&rsquo; par &lsquo;/&rsquo; (et inversement)</li>
<li>&lsquo;+&rsquo; par &lsquo;-&rsquo;</li>
<li>&lsquo;!&rsquo; par &lsquo;?&rsquo;</li>
<li>&lsquo;#&rsquo; par &lsquo;@&rsquo;</li>
</ul>
<p>La fonction <code>encrypt</code> prend en paramètre le mot de passe transformé, une chaîne de caractères &lsquo;key&rsquo; contenant le nom de l&rsquo;utilisateur répété plusieurs fois jusqu&rsquo;à ce qu&rsquo;elle fasse 32 caractères (<code>JeanneJeanneJeanneJeanneJe</code>) et la chaîne de caractères &lsquo;58ee6d5465a345d1&rsquo;.</p>
<p><code>encrypt</code> effectue simplement un chiffrement AES sur le mot de passe avec la clé et comme IV la chaîne mentionnée plus haut.</p>
<h3 id="solution">Solution</h3>
<p>Pour trouver la solution, il suffit simplement de générer le mot de passe à partir du hash fourni dans le fichier <code>shadow</code> en effectuant les opérations inverses.</p>
<p>On décode le hash en base64, ensuite on le déchiffre avec la clé et l&rsquo;IV fournis. On obtient le mot de passe qu&rsquo;on peut ensuite déchiffrer en hexadécimal, puis effectuer un XOR sur chaque caractère du mot de passe avec l&rsquo;indice du caractère dans le mot de passe.</p>
<p>Voici un script Python qui permet de faire le XOR et de remplacer les caractères pour obtenir le mot de passe de l&rsquo;utilisateur :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>code <span style="color:#f92672">=</span> [<span style="color:#ae81ff">0x37</span>, <span style="color:#ae81ff">0x54</span>,<span style="color:#ae81ff">70</span>,<span style="color:#ae81ff">0x6d</span>,<span style="color:#ae81ff">0x77</span>,<span style="color:#ae81ff">0x2a</span>,<span style="color:#ae81ff">0x36</span>,<span style="color:#ae81ff">0x72</span>,<span style="color:#ae81ff">0x5c</span>,<span style="color:#ae81ff">0x26</span>,<span style="color:#ae81ff">0x59</span>,<span style="color:#ae81ff">0x7e</span>,<span style="color:#ae81ff">0x68</span>,<span style="color:#ae81ff">0x62</span>,<span style="color:#ae81ff">0x21</span>,<span style="color:#ae81ff">0x66</span>,<span style="color:#ae81ff">0x34</span>,<span style="color:#ae81ff">0x3e</span>,<span style="color:#ae81ff">0x50</span>,<span style="color:#ae81ff">0x56</span>,<span style="color:#ae81ff">0x40</span>,<span style="color:#ae81ff">0x41</span>,<span style="color:#ae81ff">0x25</span>,<span style="color:#ae81ff">0x65</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>result <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(len(code) <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>):
</span></span><span style="display:flex;"><span>  result <span style="color:#f92672">+=</span> chr(code[i] <span style="color:#f92672">^</span> i)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>result <span style="color:#f92672">=</span> result[::<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>final_string <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> l <span style="color:#f92672">in</span> result :
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> l <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;_&#39;</span> :
</span></span><span style="display:flex;"><span>    final_string <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#34;/&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">elif</span> l <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;/&#34;</span> :
</span></span><span style="display:flex;"><span>    final_string <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#34;_&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">elif</span> l <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;+&#34;</span> :
</span></span><span style="display:flex;"><span>    final_string <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#34;-&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">elif</span> l <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;-&#34;</span> :
</span></span><span style="display:flex;"><span>    final_string <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#34;+&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">elif</span> l <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;?&#34;</span> :
</span></span><span style="display:flex;"><span>    final_string <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#34;!&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">elif</span> l <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;!&#34;</span> :
</span></span><span style="display:flex;"><span>    final_string <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#34;?&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">elif</span> l <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;@&#34;</span> :
</span></span><span style="display:flex;"><span>    final_string <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#34;#&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">elif</span> l <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;#&#34;</span> :
</span></span><span style="display:flex;"><span>    final_string <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#34;@&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span> :
</span></span><span style="display:flex;"><span>    final_string <span style="color:#f92672">+=</span> l
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print(final_string)
</span></span></code></pre></div><p>Ce script, une fois exécuté, nous donne la chaîne : <code>UDns_0uT_Sudo_i$_BETT3r</code>.</p>
<p>Ce challenge avait une petite erreur au niveau du hash, donc la solution
n&rsquo;était pas totalement correcte. Il fallait entrer
<code>7Urns_0uT_Sudo_i$_BETT3r</code> pour valider le challenge.</p>
<h2 id="customfs">CustomFs</h2>
<p>Les sources du challenge sont disponibles <a href="https://github.com/JeanneD-Hack-CTF/JeanneD-Hack-CTF-2025/tree/main/reverse/Custom_Fs">ici</a>.</p>
<blockquote>
<p>Dans ce défi, votre objectif est de comprendre et utiliser un système de fichier
inconnu jusqu&rsquo;à présent. Seul problème: Le programme que vous avez reçu ne peut pas
extraire le format de système de fichier, mais uniquement en créer un. Votre mission
consiste à déterminer la structure et le contenu du fichier <code>flag.txt</code>.</p>
<p>Le flag est <code>JDHACK{$(sha256sum flag.txt | cut -d ' ' -f1)}</code></p></blockquote>
<p>Ce challenge est le dernier de la catégorie reverse et est classé comme difficile. Pour ce dernier défi, nous recevons un programme
compilé sans symboles, ainsi qu&rsquo;un fichier <code>fs.packed</code> au format inconnu. Lorsque nous exécutons le programme
sans argument, voici ce que nous obtenons :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>Usage: ./main CMD
</span></span><span style="display:flex;"><span>Available commandes:
</span></span><span style="display:flex;"><span>pack &lt;directory&gt; &lt;file&gt;
</span></span><span style="display:flex;"><span>unpack &lt;file&gt; &lt;directory&gt;
</span></span></code></pre></div><p>On remarque qu&rsquo;il est possible de &ldquo;packager&rdquo; un dossier en un fichier et vice versa. Cependant, si l&rsquo;on tente d&rsquo;utiliser
la commande <code>unpack</code> sur <code>fs.packed</code>, le programme renvoie une erreur :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>Error: Not implemented
</span></span></code></pre></div><p>On dirait qu&rsquo;on va devoir se débrouiller seuls&hellip; On commence par ouvrir le programme dans Ghidra et on se dirige vers l&rsquo;entrypoint du programme :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">void</span> processEntry <span style="color:#a6e22e">entry</span>(undefined8 param_1,undefined8 param_2) {
</span></span><span style="display:flex;"><span>  undefined1 auStack_8 [<span style="color:#ae81ff">8</span>];
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">__libc_start_main</span>(FUN_001025d7,param_2,<span style="color:#f92672">&amp;</span>stack0x00000008,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>,param_1,auStack_8);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">do</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/* WARNING: Do nothing block with infinite loop */</span>
</span></span><span style="display:flex;"><span>  } <span style="color:#66d9ef">while</span>( true );
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>On retrouve la fonction <code>__libc_start_main</code>. Avec un peu d&rsquo;expérience (ou une recherche sur Google), on sait que le premier
paramètre est un pointeur vers la fonction <code>main</code>, que l&rsquo;on peut renommer :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>(<span style="color:#66d9ef">int</span> argc,<span style="color:#66d9ef">char</span> <span style="color:#f92672">**</span>argv) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (argc <span style="color:#f92672">!=</span> <span style="color:#ae81ff">4</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Show help
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">goto</span> LAB_00102820;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  iVar2 <span style="color:#f92672">=</span> <span style="color:#a6e22e">strcmp</span>(<span style="color:#e6db74">&#34;pack&#34;</span>,argv[<span style="color:#ae81ff">1</span>]);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (iVar2 <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0</span>) {
</span></span><span style="display:flex;"><span>    iVar2 <span style="color:#f92672">=</span> <span style="color:#a6e22e">strcmp</span>(<span style="color:#e6db74">&#34;unpack&#34;</span>,argv[<span style="color:#ae81ff">1</span>]);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (iVar2 <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">fwrite</span>(<span style="color:#e6db74">&#34;Error: Not implemented</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>,<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">0x17</span>,stderr);
</span></span><span style="display:flex;"><span>      iVar2 <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">fprintf</span>(stderr,<span style="color:#e6db74">&#34;Error: Unknown command </span><span style="color:#ae81ff">\&#39;</span><span style="color:#e6db74">%s</span><span style="color:#ae81ff">\&#39;\n</span><span style="color:#e6db74">&#34;</span>,argv[<span style="color:#ae81ff">1</span>]);
</span></span><span style="display:flex;"><span>      iVar2 <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">goto</span> LAB_00102820;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  cVar1 <span style="color:#f92672">=</span> <span style="color:#a6e22e">FUN_00102544</span>(argv[<span style="color:#ae81ff">2</span>]);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (cVar1 <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#39;\x01&#39;</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">fprintf</span>(stderr,<span style="color:#e6db74">&#34;Error: </span><span style="color:#ae81ff">\&#39;</span><span style="color:#e6db74">%s</span><span style="color:#ae81ff">\&#39;</span><span style="color:#e6db74"> is not a valid directory</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>,argv[<span style="color:#ae81ff">2</span>]);
</span></span><span style="display:flex;"><span>    iVar2 <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">goto</span> LAB_00102820;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  local_18 <span style="color:#f92672">=</span> <span style="color:#a6e22e">FUN_00101259</span>(argv[<span style="color:#ae81ff">2</span>]);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (local_18 <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0</span>) {
</span></span><span style="display:flex;"><span>    iVar2 <span style="color:#f92672">=</span> <span style="color:#a6e22e">FUN_00101dde</span>(local_18,argv[<span style="color:#ae81ff">2</span>]);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (iVar2 <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>) {
</span></span><span style="display:flex;"><span>      iVar2 <span style="color:#f92672">=</span> <span style="color:#a6e22e">FUN_00101e25</span>(local_18,argv[<span style="color:#ae81ff">3</span>]);
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (iVar2 <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0</span>) <span style="color:#66d9ef">goto</span> LAB_00102769;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>    LAB_00102769:
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">fprintf</span>(stderr,<span style="color:#e6db74">&#34;Fail to save filesystem to </span><span style="color:#ae81ff">\&#39;</span><span style="color:#e6db74">%s</span><span style="color:#ae81ff">\&#39;\n</span><span style="color:#e6db74">&#34;</span>,argv[<span style="color:#ae81ff">3</span>]);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">FUN_00101342</span>(<span style="color:#f92672">&amp;</span>local_18);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  iVar2 <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>LAB_00102820:
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> iVar2;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>La fonction <code>FUN_00102544</code> est relativement simple ; elle se contente de vérifier si le paramètre correspond à un dossier valide ou non.
Passons maintenant à la fonction <code>FUN_00101259</code> :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span> <span style="color:#a6e22e">FUN_00101259</span>(<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>param_1) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">size_t</span> sVar1;
</span></span><span style="display:flex;"><span>  undefined8 uVar2;
</span></span><span style="display:flex;"><span>  undefined2 <span style="color:#f92672">*</span>local_10;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  local_10 <span style="color:#f92672">=</span> (undefined2 <span style="color:#f92672">*</span>)<span style="color:#a6e22e">malloc</span>(<span style="color:#ae81ff">0x38</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (local_10 <span style="color:#f92672">!=</span> (undefined2 <span style="color:#f92672">*</span>)<span style="color:#ae81ff">0x0</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">*</span>local_10 <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x1337</span>;
</span></span><span style="display:flex;"><span>    sVar1 <span style="color:#f92672">=</span> <span style="color:#a6e22e">strlen</span>(param_1);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (sVar1 <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0x20</span>) {
</span></span><span style="display:flex;"><span>      sVar1 <span style="color:#f92672">=</span> <span style="color:#a6e22e">strlen</span>(param_1);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>      sVar1 <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x20</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">memcpy</span>(local_10 <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>,param_1,sVar1);
</span></span><span style="display:flex;"><span>    uVar2 <span style="color:#f92672">=</span> <span style="color:#a6e22e">FUN_00101eea</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">*</span>(undefined8 <span style="color:#f92672">*</span>)(local_10 <span style="color:#f92672">+</span> <span style="color:#ae81ff">0x14</span>) <span style="color:#f92672">=</span> uVar2;
</span></span><span style="display:flex;"><span>    uVar2 <span style="color:#f92672">=</span> <span style="color:#a6e22e">FUN_00101eea</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">*</span>(undefined8 <span style="color:#f92672">*</span>)(local_10 <span style="color:#f92672">+</span> <span style="color:#ae81ff">0x18</span>) <span style="color:#f92672">=</span> uVar2;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> ((<span style="color:#f92672">*</span>(<span style="color:#66d9ef">long</span> <span style="color:#f92672">*</span>)(local_10 <span style="color:#f92672">+</span> <span style="color:#ae81ff">0x18</span>) <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>) <span style="color:#f92672">||</span> (<span style="color:#f92672">*</span>(<span style="color:#66d9ef">long</span> <span style="color:#f92672">*</span>)(local_10 <span style="color:#f92672">+</span> <span style="color:#ae81ff">0x14</span>) <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>)) {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (<span style="color:#f92672">*</span>(<span style="color:#66d9ef">long</span> <span style="color:#f92672">*</span>)(local_10 <span style="color:#f92672">+</span> <span style="color:#ae81ff">0x18</span>) <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">FUN_001024ea</span>(local_10 <span style="color:#f92672">+</span> <span style="color:#ae81ff">0x18</span>);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (<span style="color:#f92672">*</span>(<span style="color:#66d9ef">long</span> <span style="color:#f92672">*</span>)(local_10 <span style="color:#f92672">+</span> <span style="color:#ae81ff">0x14</span>) <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">FUN_001024ea</span>(local_10 <span style="color:#f92672">+</span> <span style="color:#ae81ff">0x14</span>);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      local_10 <span style="color:#f92672">=</span> (undefined2 <span style="color:#f92672">*</span>)<span style="color:#ae81ff">0x0</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> local_10;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>On observe un appel à <code>malloc</code> qui permet d&rsquo;allouer une zone mémoire de 0x38 octets. Cette zone mémoire est ensuite
transmise aux différentes fonctions. On peut en déduire qu&rsquo;il s&rsquo;agit d&rsquo;une fonction d&rsquo;initialisation pour une structure.
Il est facile de créer cette structure en effectuant un <em>clic droit</em> sur <code>local_10</code>, puis en sélectionnant
<em>Auto Create Structure</em>. Avec un peu de renommage et de typage, on obtient ceci :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>Filesystem <span style="color:#f92672">*</span> <span style="color:#a6e22e">create_filesystem</span>(<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>directory) {
</span></span><span style="display:flex;"><span>  OtherStruct <span style="color:#f92672">*</span>substruct;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">size_t</span> length;
</span></span><span style="display:flex;"><span>  Filesystem <span style="color:#f92672">*</span>fs;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  fs <span style="color:#f92672">=</span> (Filesystem <span style="color:#f92672">*</span>)<span style="color:#a6e22e">malloc</span>(<span style="color:#ae81ff">0x38</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (fs <span style="color:#f92672">!=</span> (Filesystem <span style="color:#f92672">*</span>)<span style="color:#ae81ff">0x0</span>) {
</span></span><span style="display:flex;"><span>    fs<span style="color:#f92672">-&gt;</span>magic <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x1337</span>;
</span></span><span style="display:flex;"><span>    length <span style="color:#f92672">=</span> <span style="color:#a6e22e">strlen</span>(directory);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (length <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0x20</span>) {
</span></span><span style="display:flex;"><span>      length <span style="color:#f92672">=</span> <span style="color:#a6e22e">strlen</span>(directory);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>      length <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x20</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">memcpy</span>(fs<span style="color:#f92672">-&gt;</span>directory,directory,length);
</span></span><span style="display:flex;"><span>    substruct <span style="color:#f92672">=</span> (OtherStruct <span style="color:#f92672">*</span>)<span style="color:#a6e22e">create_other_struct</span>();
</span></span><span style="display:flex;"><span>    fs<span style="color:#f92672">-&gt;</span>struct1 <span style="color:#f92672">=</span> substruct;
</span></span><span style="display:flex;"><span>    substruct <span style="color:#f92672">=</span> (OtherStruct <span style="color:#f92672">*</span>)<span style="color:#a6e22e">create_other_struct</span>();
</span></span><span style="display:flex;"><span>    fs<span style="color:#f92672">-&gt;</span>struct2 <span style="color:#f92672">=</span> substruct;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> ((fs<span style="color:#f92672">-&gt;</span>struct2 <span style="color:#f92672">==</span> (OtherStruct <span style="color:#f92672">*</span>)<span style="color:#ae81ff">0x0</span>) <span style="color:#f92672">||</span> (fs<span style="color:#f92672">-&gt;</span>struct1 <span style="color:#f92672">==</span> (OtherStruct <span style="color:#f92672">*</span>)<span style="color:#ae81ff">0x0</span>)) {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (fs<span style="color:#f92672">-&gt;</span>struct2 <span style="color:#f92672">!=</span> (OtherStruct <span style="color:#f92672">*</span>)<span style="color:#ae81ff">0x0</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">destroy_other_struct</span>(<span style="color:#f92672">&amp;</span>fs<span style="color:#f92672">-&gt;</span>struct2);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (fs<span style="color:#f92672">-&gt;</span>struct1 <span style="color:#f92672">!=</span> (OtherStruct <span style="color:#f92672">*</span>)<span style="color:#ae81ff">0x0</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">destroy_other_struct</span>(<span style="color:#f92672">&amp;</span>fs<span style="color:#f92672">-&gt;</span>struct1);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      fs <span style="color:#f92672">=</span> (Filesystem <span style="color:#f92672">*</span>)<span style="color:#ae81ff">0x0</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> fs;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>La fonction <code>create_other_struct</code> fait également appel à <code>malloc</code> pour créer une structure de taille 0x10. La fonction
<code>destroy_other_struct</code> permet de libérer les ressources associées à la structure en cas d&rsquo;erreur. Elle possède le code suivant :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">destroy_other_struct_helper</span>(OtherStruct <span style="color:#f92672">*</span>other,<span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>func,undefined8 param_3) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> ((other <span style="color:#f92672">!=</span> (OtherStruct <span style="color:#f92672">*</span>)<span style="color:#ae81ff">0x0</span>) <span style="color:#f92672">&amp;&amp;</span> (func <span style="color:#f92672">!=</span> (<span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>)<span style="color:#ae81ff">0x0</span>)) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">FUN_00102143</span>(other<span style="color:#f92672">-&gt;</span>field1_0x8,func,param_3);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">destroy_other_struct</span>(OtherStruct <span style="color:#f92672">**</span>otherptr) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> ((otherptr <span style="color:#f92672">!=</span> (OtherStruct <span style="color:#f92672">**</span>)<span style="color:#ae81ff">0x0</span>) <span style="color:#f92672">&amp;&amp;</span> (<span style="color:#f92672">*</span>otherptr <span style="color:#f92672">!=</span> (OtherStruct <span style="color:#f92672">*</span>)<span style="color:#ae81ff">0x0</span>)) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">destroy_other_struct_helper</span>(<span style="color:#f92672">*</span>otherptr,FUN_001024c2,<span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">free</span>(<span style="color:#f92672">*</span>otherptr);
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">*</span>otherptr <span style="color:#f92672">=</span> (OtherStruct <span style="color:#f92672">*</span>)<span style="color:#ae81ff">0x0</span>;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>La fonction <code>FUN_001024c2</code> se limite à appeler <code>free</code> sur son paramètre. Quant à la fonction <code>FUN_00102143</code>, elle possède le code suivant :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">FUN_00102143</span>(<span style="color:#66d9ef">long</span> param_1,code <span style="color:#f92672">*</span>func,undefined8 param_3) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (param_1 <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">FUN_00102143</span>(<span style="color:#f92672">*</span>(undefined8 <span style="color:#f92672">*</span>)(param_1 <span style="color:#f92672">+</span> <span style="color:#ae81ff">0x10</span>),func,param_3);
</span></span><span style="display:flex;"><span>    (<span style="color:#f92672">*</span>func)(param_1,param_3);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">FUN_00102143</span>(<span style="color:#f92672">*</span>(undefined8 <span style="color:#f92672">*</span>)(param_1 <span style="color:#f92672">+</span> <span style="color:#ae81ff">0x18</span>),func,param_3);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>En examinant attentivement le code, on remarque que la fonction <code>FUN_00102143</code> s&rsquo;appelle récursivement sur deux
sous-éléments et, entre-temps, appelle la fonction de callback passée en paramètre sur l&rsquo;élément actuel. Cette
structure correspond à un parcours en profondeur d&rsquo;un arbre binaire. En cas de doute, il est possible de demander
à un LLM de notre choix :</p>
<pre tabindex="0"><code>&gt; A ton avis, à quoi correspond cette fonction: &lt;code de FUN_00102143&gt;

La fonction FUN_00102143 que vous avez fournie semble être une implémentation d&#39;un parcours récursif d&#39;une 
structure de données en forme d&#39;arbre, probablement un arbre binaire.
</code></pre><p>On peut maintenant retyper les différentes structures et fonctions, on remplace
&ldquo;OtherStruct&rdquo; par &ldquo;Tree&rdquo; :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">deep_first_walk</span>(Node <span style="color:#f92672">*</span>node,code <span style="color:#f92672">*</span>func,undefined8 param_3) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (node <span style="color:#f92672">!=</span> (Node <span style="color:#f92672">*</span>)<span style="color:#ae81ff">0x0</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">deep_first_walk</span>((Node <span style="color:#f92672">*</span>)node<span style="color:#f92672">-&gt;</span>left,func,param_3);
</span></span><span style="display:flex;"><span>    (<span style="color:#f92672">*</span>func)(node,param_3);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">deep_first_walk</span>((Node <span style="color:#f92672">*</span>)node<span style="color:#f92672">-&gt;</span>right,func,param_3);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">destroy_tree_helper</span>(Tree <span style="color:#f92672">*</span>tree,<span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>func,undefined8 param_3) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> ((tree <span style="color:#f92672">!=</span> (Tree <span style="color:#f92672">*</span>)<span style="color:#ae81ff">0x0</span>) <span style="color:#f92672">&amp;&amp;</span> (func <span style="color:#f92672">!=</span> (<span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>)<span style="color:#ae81ff">0x0</span>)) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">deep_first_walk</span>((Node <span style="color:#f92672">*</span>)tree<span style="color:#f92672">-&gt;</span>root,func,param_3);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">destroy_tree</span>(Tree <span style="color:#f92672">**</span>otherptr) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> ((otherptr <span style="color:#f92672">!=</span> (Tree <span style="color:#f92672">**</span>)<span style="color:#ae81ff">0x0</span>) <span style="color:#f92672">&amp;&amp;</span> (<span style="color:#f92672">*</span>otherptr <span style="color:#f92672">!=</span> (Tree <span style="color:#f92672">*</span>)<span style="color:#ae81ff">0x0</span>)) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">destroy_tree_helper</span>(<span style="color:#f92672">*</span>otherptr,FUN_001024c2,<span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">free</span>(<span style="color:#f92672">*</span>otherptr);
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">*</span>otherptr <span style="color:#f92672">=</span> (Tree <span style="color:#f92672">*</span>)<span style="color:#ae81ff">0x0</span>;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Afin de mieux visualiser les choses, on peut réaliser un schéma des différentes structures :</p>
<div style="text-align: center;">
  <img style="max-width: 800px; height: auto;" src="/images/writeup_reverse_2025/customfs_structs.png">
</div>
<p>Si l&rsquo;on revient maintenant à notre fonction <code>main</code>, nous pouvons passer à l&rsquo;analyse de la seconde fonction <code>FUN_00101dde</code> :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">FUN_00101dde</span>(Filesystem <span style="color:#f92672">*</span>fs,<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>directory) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">int</span> res <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> ((fs <span style="color:#f92672">!=</span> (Filesystem <span style="color:#f92672">*</span>)<span style="color:#ae81ff">0x0</span>) <span style="color:#f92672">&amp;&amp;</span> (directory <span style="color:#f92672">!=</span> (<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>)<span style="color:#ae81ff">0x0</span>)) {
</span></span><span style="display:flex;"><span>    res <span style="color:#f92672">=</span> <span style="color:#a6e22e">iter_dir</span>(directory,FUN_00101a39,fs);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> res;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">iter_dir</span>(<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>directory, code <span style="color:#f92672">*</span>callback, Filesystem <span style="color:#f92672">*</span>fs) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">int</span> result;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">int</span> v;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">size_t</span> len;
</span></span><span style="display:flex;"><span>  DIR <span style="color:#f92672">*</span>dir;
</span></span><span style="display:flex;"><span>  dirent <span style="color:#f92672">*</span>entry;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">long</span> in_FS_OFFSET;
</span></span><span style="display:flex;"><span>  stat st;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">char</span> filename [<span style="color:#ae81ff">4104</span>];
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  len <span style="color:#f92672">=</span> <span style="color:#a6e22e">strlen</span>(directory);
</span></span><span style="display:flex;"><span>  result <span style="color:#f92672">=</span> (<span style="color:#66d9ef">int</span>)len;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (result <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0xfff</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">strcpy</span>(filename,directory);
</span></span><span style="display:flex;"><span>    filename[result] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;/&#39;</span>;
</span></span><span style="display:flex;"><span>    dir <span style="color:#f92672">=</span> <span style="color:#a6e22e">opendir</span>(directory);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (dir <span style="color:#f92672">==</span> (DIR <span style="color:#f92672">*</span>)<span style="color:#ae81ff">0x0</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">fprintf</span>(stderr,<span style="color:#e6db74">&#34;can</span><span style="color:#ae81ff">\&#39;</span><span style="color:#e6db74">t open %s</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>,directory);
</span></span><span style="display:flex;"><span>      result <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">while</span> (entry <span style="color:#f92672">=</span> <span style="color:#a6e22e">readdir</span>(dir), entry <span style="color:#f92672">!=</span> (dirent <span style="color:#f92672">*</span>)<span style="color:#ae81ff">0x0</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (((entry<span style="color:#f92672">-&gt;</span>d_name[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#39;.&#39;</span>) <span style="color:#f92672">&amp;&amp;</span> (v <span style="color:#f92672">=</span> <span style="color:#a6e22e">strcmp</span>(entry<span style="color:#f92672">-&gt;</span>d_name,<span style="color:#e6db74">&#34;.&#34;</span>), v <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0</span>)) <span style="color:#f92672">&amp;&amp;</span>
</span></span><span style="display:flex;"><span>          (v <span style="color:#f92672">=</span> <span style="color:#a6e22e">strcmp</span>(entry<span style="color:#f92672">-&gt;</span>d_name,<span style="color:#e6db74">&#34;..&#34;</span>), v <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0</span>)) {
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">strncpy</span>(filename <span style="color:#f92672">+</span> (result <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>),entry<span style="color:#f92672">-&gt;</span>d_name,(<span style="color:#66d9ef">long</span>)(<span style="color:#ae81ff">0x1000</span> <span style="color:#f92672">-</span> (result <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>)));
</span></span><span style="display:flex;"><span>          v <span style="color:#f92672">=</span> <span style="color:#a6e22e">lstat</span>(filename,<span style="color:#f92672">&amp;</span>st);
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">if</span> (v <span style="color:#f92672">==</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">fprintf</span>(stderr,<span style="color:#e6db74">&#34;can</span><span style="color:#ae81ff">\&#39;</span><span style="color:#e6db74">t stat %s</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>,filename);
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (((st.st_mode <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xf000</span>) <span style="color:#f92672">==</span> <span style="color:#ae81ff">0x4000</span>) <span style="color:#f92672">&amp;&amp;</span> (v <span style="color:#f92672">=</span> <span style="color:#a6e22e">iter_dir</span>(filename,callback,fs), v <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0</span>)) {
</span></span><span style="display:flex;"><span>              result <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>              <span style="color:#66d9ef">goto</span> LAB_00101dc8;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            (<span style="color:#f92672">*</span>callback)(fs,filename);
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (dir <span style="color:#f92672">!=</span> (DIR <span style="color:#f92672">*</span>)<span style="color:#ae81ff">0x0</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">closedir</span>(dir);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      result <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>    result <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>LAB_00101dc8:
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> result;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>On peut voir que ces fonctions vont permettre d&rsquo;itérer récursivement sur l&rsquo;ensemble des fichiers présents
dans une arborescence (d&rsquo;où le nom <code>iter_dir</code>). Il est donc intéressant d&rsquo;examiner la fonction de callback,
ici <code>FUN_00101a39</code>, que l&rsquo;on renomme en <code>iter_dir_callback</code> :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">iter_dir_callback</span>(Filesystem <span style="color:#f92672">*</span>fs,<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>filename) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">int</span> res;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">ssize_t</span> len;
</span></span><span style="display:flex;"><span>  stat st;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">char</span> name [<span style="color:#ae81ff">4104</span>];
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  res <span style="color:#f92672">=</span> <span style="color:#a6e22e">lstat</span>(filename,<span style="color:#f92672">&amp;</span>st);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (res <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> ((st.st_mode <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xf000</span>) <span style="color:#f92672">==</span> S_IFLNK) {
</span></span><span style="display:flex;"><span>      len <span style="color:#f92672">=</span> <span style="color:#a6e22e">readlink</span>(filename,name,<span style="color:#ae81ff">0x1000</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (len <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0</span>) {
</span></span><span style="display:flex;"><span>        res <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>        name[len] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;\0&#39;</span>; 
</span></span><span style="display:flex;"><span>        res <span style="color:#f92672">=</span> <span style="color:#a6e22e">FUN_00101855</span>(fs,filename,name); <span style="color:#75715e">/* Symbolic link */</span>
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> ((st.st_mode <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xf000</span>) <span style="color:#f92672">==</span> S_IFDIR) { 
</span></span><span style="display:flex;"><span>      res <span style="color:#f92672">=</span> <span style="color:#a6e22e">FUN_001016f3</span>(fs,filename); <span style="color:#75715e">/* Directory */</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span> { 
</span></span><span style="display:flex;"><span>      res <span style="color:#f92672">=</span> <span style="color:#a6e22e">FUN_001013a4</span>(fs,filename,st.st_size); <span style="color:#75715e">/* File */</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>    res <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> Res;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Cette fonction va vérifier le type de fichier traité à partir du nom transmit en paramètre. Elle appelle ensuite les
fonctions <code>FUN_00101855</code> pour un lien symbolique, <code>FUN_001016f3</code> pour un dossier et <code>FUN_001013a4</code> pour les fichiers normaux.</p>
<p>On peut commencer par analyser le code traitant les fichiers classiques, les deux autres fonctions étant très similaires.
Après un peu de renommage et de typage, on obtient la fonction suivante :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">FUN_001013a4</span>(Filesystem <span style="color:#f92672">*</span>fs,<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>filename,<span style="color:#66d9ef">size_t</span> size) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">int</span> iVar1;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">size_t</span> len;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">long</span> i;
</span></span><span style="display:flex;"><span>  undefined8 <span style="color:#f92672">*</span>puVar2;
</span></span><span style="display:flex;"><span>  string <span style="color:#f92672">*</span>value1;
</span></span><span style="display:flex;"><span>  string <span style="color:#f92672">*</span>value2;
</span></span><span style="display:flex;"><span>  Node <span style="color:#f92672">*</span>node1;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>file_content;
</span></span><span style="display:flex;"><span>  FILE <span style="color:#f92672">*</span>fp;
</span></span><span style="display:flex;"><span>  ulong hashval;
</span></span><span style="display:flex;"><span>  Node <span style="color:#f92672">*</span>node2;
</span></span><span style="display:flex;"><span>  string string;
</span></span><span style="display:flex;"><span>  undefined8 local_1008 [<span style="color:#ae81ff">511</span>];
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  string.size <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x454c4946</span>; <span style="color:#75715e">/* -&gt; b&#39;FILE&#39; */</span>
</span></span><span style="display:flex;"><span>  string.str <span style="color:#f92672">=</span> (<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>)<span style="color:#ae81ff">0x0</span>;
</span></span><span style="display:flex;"><span>  len <span style="color:#f92672">=</span> <span style="color:#a6e22e">strlen</span>(filename);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (len <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0x1000</span>) {
</span></span><span style="display:flex;"><span>    len <span style="color:#f92672">=</span> <span style="color:#a6e22e">strlen</span>(filename);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>    len <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x1000</span>;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">memcpy</span>((<span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>)((<span style="color:#66d9ef">long</span>)<span style="color:#f92672">&amp;</span>string.size <span style="color:#f92672">+</span> <span style="color:#ae81ff">4</span>),filename,len);
</span></span><span style="display:flex;"><span>  value1 <span style="color:#f92672">=</span> (string <span style="color:#f92672">*</span>)<span style="color:#a6e22e">alloc_string</span>(<span style="color:#f92672">&amp;</span>string);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (value1 <span style="color:#f92672">==</span> (string <span style="color:#f92672">*</span>)<span style="color:#ae81ff">0x0</span>) {
</span></span><span style="display:flex;"><span>    iVar1 <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>    file_content <span style="color:#f92672">=</span> <span style="color:#a6e22e">malloc</span>(size <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (file_content <span style="color:#f92672">==</span> (<span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>)<span style="color:#ae81ff">0x0</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">destroy_string</span>(<span style="color:#f92672">&amp;</span>value1);
</span></span><span style="display:flex;"><span>      iVar1 <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>      fp <span style="color:#f92672">=</span> <span style="color:#a6e22e">fopen</span>(filename,<span style="color:#e6db74">&#34;r&#34;</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (fp <span style="color:#f92672">==</span> (FILE <span style="color:#f92672">*</span>)<span style="color:#ae81ff">0x0</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">destroy_string</span>(<span style="color:#f92672">&amp;</span>value1);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">free</span>(file_content);
</span></span><span style="display:flex;"><span>        iVar1 <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>        len <span style="color:#f92672">=</span> <span style="color:#a6e22e">fread</span>(file_content,size,<span style="color:#ae81ff">1</span>,fp);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (len <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>) {
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">fclose</span>(fp);
</span></span><span style="display:flex;"><span>          value2 <span style="color:#f92672">=</span> <span style="color:#a6e22e">create_string</span>(file_content,size);
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">if</span> (value2 <span style="color:#f92672">==</span> (string <span style="color:#f92672">*</span>)<span style="color:#ae81ff">0x0</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">destroy_string</span>(<span style="color:#f92672">&amp;</span>value1);
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">free</span>(file_content);
</span></span><span style="display:flex;"><span>            iVar1 <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>            hashval <span style="color:#f92672">=</span> <span style="color:#a6e22e">hash_string</span>(value1);
</span></span><span style="display:flex;"><span>            node1 <span style="color:#f92672">=</span> <span style="color:#a6e22e">create_node</span>(hashval,value1);
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (node1 <span style="color:#f92672">==</span> (Node <span style="color:#f92672">*</span>)<span style="color:#ae81ff">0x0</span>) {
</span></span><span style="display:flex;"><span>              <span style="color:#a6e22e">destroy_string</span>(<span style="color:#f92672">&amp;</span>value1);
</span></span><span style="display:flex;"><span>              <span style="color:#a6e22e">destroy_string</span>(<span style="color:#f92672">&amp;</span>value2);
</span></span><span style="display:flex;"><span>              iVar1 <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>              node2 <span style="color:#f92672">=</span> <span style="color:#a6e22e">create_node</span>(hashval,value2);
</span></span><span style="display:flex;"><span>              <span style="color:#66d9ef">if</span> (node2 <span style="color:#f92672">==</span> (Node <span style="color:#f92672">*</span>)<span style="color:#ae81ff">0x0</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">FUN_00102486</span>(<span style="color:#f92672">&amp;</span>node1);
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">destroy_string</span>(<span style="color:#f92672">&amp;</span>value1);
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">destroy_string</span>(<span style="color:#f92672">&amp;</span>value2);
</span></span><span style="display:flex;"><span>                iVar1 <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>              }
</span></span><span style="display:flex;"><span>              <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">add_node</span>(fs<span style="color:#f92672">-&gt;</span>t2,node1);
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">add_node</span>(fs<span style="color:#f92672">-&gt;</span>t1,node2);
</span></span><span style="display:flex;"><span>                iVar1 <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>              }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">destroy_string</span>(<span style="color:#f92672">&amp;</span>value1);
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">free</span>(file_content);
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">fclose</span>(fp);
</span></span><span style="display:flex;"><span>          iVar1 <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> iVar1;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Le programme effectue les actions suivantes :</p>
<ol>
<li>Crée une structure <code>string</code> et y ajoute &lsquo;FILE&rsquo; suivi du nom du fichier.</li>
<li>Lit le contenu du fichier et le stocke dans une autre structure <code>string</code>.</li>
<li>Calcule une valeur de hachage sur la première <code>string</code> contenant le nom du fichier et ajoute deux
nœuds dans les deux arbres de la structure <code>Filesystem</code>, le premier étant le nom du fichier
et le second son contenu.</li>
</ol>
<p>On peut donc renommer cette fonction en <code>add_file_to_fs</code> et répéter les mêmes opérations pour les
deux autres fonctions vues précédemment. On obtient alors :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">iter_dir_callback</span>(Filesystem <span style="color:#f92672">*</span>fs,<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>filename) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">int</span> res;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">ssize_t</span> len;
</span></span><span style="display:flex;"><span>  stat st;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">char</span> name [<span style="color:#ae81ff">4104</span>];
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  res <span style="color:#f92672">=</span> <span style="color:#a6e22e">lstat</span>(filename,<span style="color:#f92672">&amp;</span>st);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (res <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> ((st.st_mode <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xf000</span>) <span style="color:#f92672">==</span> S_IFLNK) {
</span></span><span style="display:flex;"><span>      len <span style="color:#f92672">=</span> <span style="color:#a6e22e">readlink</span>(filename,name,<span style="color:#ae81ff">0x1000</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (len <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0</span>) {
</span></span><span style="display:flex;"><span>        res <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>        name[len] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;\0&#39;</span>; 
</span></span><span style="display:flex;"><span>        res <span style="color:#f92672">=</span> <span style="color:#a6e22e">add_link_to_filesystem</span>(fs,filename,name);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> ((st.st_mode <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xf000</span>) <span style="color:#f92672">==</span> S_IFDIR) { 
</span></span><span style="display:flex;"><span>      res <span style="color:#f92672">=</span> <span style="color:#a6e22e">add_dir_to_filesystem</span>(fs,filename);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span> { 
</span></span><span style="display:flex;"><span>      res <span style="color:#f92672">=</span> <span style="color:#a6e22e">add_file_to_filesystem</span>(fs,filename,st.st_size);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>    res <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> Res;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Il nous reste maintenant une dernière fonction à étudier dans <code>main</code> :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>fs <span style="color:#f92672">=</span> <span style="color:#a6e22e">create_filesystem</span>(argv[<span style="color:#ae81ff">2</span>]);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> (fs <span style="color:#f92672">!=</span> (Filesystem <span style="color:#f92672">*</span>)<span style="color:#ae81ff">0x0</span>) {
</span></span><span style="display:flex;"><span>  r <span style="color:#f92672">=</span> <span style="color:#a6e22e">add_filesystem</span>(fs,argv[<span style="color:#ae81ff">2</span>]);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (r <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>) {
</span></span><span style="display:flex;"><span>    r <span style="color:#f92672">=</span> <span style="color:#a6e22e">FUN_00101e25</span>(fs,argv[<span style="color:#ae81ff">3</span>]);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (r <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0</span>) <span style="color:#66d9ef">goto</span> LAB_00102769;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>  LAB_00102769:
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">fprintf</span>(stderr,<span style="color:#e6db74">&#34;Fail to save filesystem to </span><span style="color:#ae81ff">\&#39;</span><span style="color:#e6db74">%s</span><span style="color:#ae81ff">\&#39;\n</span><span style="color:#e6db74">&#34;</span>,argv[<span style="color:#ae81ff">3</span>]);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">destroy_filesystem</span>(<span style="color:#f92672">&amp;</span>fs);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Vu le message d&rsquo;erreur présent juste en dessous, on peut d&rsquo;ores et déjà renommer <code>FUN_00101e25</code> en <code>save_filesystem</code>. Son
code est le suivant (une fois que l&rsquo;on a effectué notre renommage habituel) :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">save_filesystem</span>(Filesystem <span style="color:#f92672">*</span>fs,<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>filename) {
</span></span><span style="display:flex;"><span>  FILE <span style="color:#f92672">*</span>fp;
</span></span><span style="display:flex;"><span>  undefined8 r;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  fp <span style="color:#f92672">=</span> <span style="color:#a6e22e">fopen</span>(filename,<span style="color:#e6db74">&#34;w&#34;</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (fp <span style="color:#f92672">==</span> (FILE <span style="color:#f92672">*</span>)<span style="color:#ae81ff">0x0</span>) {
</span></span><span style="display:flex;"><span>    r <span style="color:#f92672">=</span> <span style="color:#ae81ff">0xffffffff</span>;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">fwrite</span>(fs,<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">1</span>,fp);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">fwrite</span>(fs<span style="color:#f92672">-&gt;</span>directory,<span style="color:#ae81ff">0x20</span>,<span style="color:#ae81ff">1</span>,fp);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">save_tree</span>(fs<span style="color:#f92672">-&gt;</span>t2,save_string,fp);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">save_tree</span>(fs<span style="color:#f92672">-&gt;</span>t1,save_string,fp);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">fclose</span>(fp);
</span></span><span style="display:flex;"><span>    r <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> r;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">save_string</span>(string <span style="color:#f92672">*</span>s,FILE <span style="color:#f92672">*</span>fp) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> ((s <span style="color:#f92672">!=</span> ) <span style="color:#f92672">&amp;&amp;</span> (fp <span style="color:#f92672">!=</span> (FILE <span style="color:#f92672">*</span>)<span style="color:#ae81ff">0x0</span>)) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">fwrite</span>(s,<span style="color:#ae81ff">8</span>,<span style="color:#ae81ff">1</span>,fp);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">fwrite</span>(s<span style="color:#f92672">-&gt;</span>str,s<span style="color:#f92672">-&gt;</span>size,<span style="color:#ae81ff">1</span>,fp);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">save_tree</span>(Tree <span style="color:#f92672">*</span>tree,<span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>callback,FILE <span style="color:#f92672">*</span>fp) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (((tree <span style="color:#f92672">!=</span> (Tree <span style="color:#f92672">*</span>)<span style="color:#ae81ff">0x0</span>) <span style="color:#f92672">&amp;&amp;</span> (callback <span style="color:#f92672">!=</span> (<span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>)<span style="color:#ae81ff">0x0</span>)) <span style="color:#f92672">&amp;&amp;</span> (fp <span style="color:#f92672">!=</span> (FILE <span style="color:#f92672">*</span>)<span style="color:#ae81ff">0x0</span>)) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">fwrite</span>(tree,<span style="color:#ae81ff">8</span>,<span style="color:#ae81ff">1</span>,fp);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">save_node</span>(tree<span style="color:#f92672">-&gt;</span>root,callback,fp);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">save_node</span>(Node <span style="color:#f92672">*</span>node,<span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>callback,FILE <span style="color:#f92672">*</span>fp) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">uint64_t</span> key;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (node <span style="color:#f92672">==</span> (Node <span style="color:#f92672">*</span>)<span style="color:#ae81ff">0x0</span>) {
</span></span><span style="display:flex;"><span>    key <span style="color:#f92672">=</span> <span style="color:#ae81ff">0xffffffffffffffff</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">fwrite</span>(<span style="color:#f92672">&amp;</span>key,<span style="color:#ae81ff">8</span>,<span style="color:#ae81ff">1</span>,fp);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>    key <span style="color:#f92672">=</span> node<span style="color:#f92672">-&gt;</span>key;
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">fwrite</span>(<span style="color:#f92672">&amp;</span>key,<span style="color:#ae81ff">8</span>,<span style="color:#ae81ff">1</span>,fp);
</span></span><span style="display:flex;"><span>    (<span style="color:#f92672">*</span>(code <span style="color:#f92672">*</span>)callback)(node<span style="color:#f92672">-&gt;</span>value,fp);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">save_node</span>(node<span style="color:#f92672">-&gt;</span>left,callback,fp);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">save_node</span>(node<span style="color:#f92672">-&gt;</span>right,callback,fp);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>On retrouve les structures habituelles avec les arbres, les nœuds et les strings. On comprend à présent que, pour
sauvegarder la structure <code>Filesystem</code> sous forme de fichier, le programme va sérialiser le premier arbre contenant
les noms des fichiers, puis sérialiser celui avec leur contenu.</p>
<p>Toutefois, il existe un lien entre les deux entrées : la valeur de hachage qui est commune aux deux entrées. On peut donc commencer
par ouvrir notre fichier <code>fs.packed</code> avec un éditeur hexadécimal. Je vous recommande l&rsquo;excellent <a href="https://imhex.werwolv.net/">ImHex</a> !</p>
<div style="text-align: center;">
  <img src="/images/writeup_reverse_2025/customfs_filename.png">
</div>
<p>On commence donc par chercher le nom de notre fichier &ldquo;flag.txt&rdquo; dans l&rsquo;éditeur.</p>
<p>Nous savons que la valeur de hachage est située juste avant le nom de notre fichier. Nous cherchons donc
maintenant <code>F1 12 56 7C E7 25 03 D5</code> dans l&rsquo;onglet <em>Binary Pattern</em> de la fenêtre <em>Find</em>. Nous obtenons
alors deux occurrences : le nom du fichier et son contenu.</p>
<p><img src="/images/writeup_reverse_2025/customfs_content.png" alt=""></p>
<p>On peut voir sur la capture que la taille du fichier (située après la valeur de hachage) est égale à <code>\x00\x02\x00\x00\x00\x00\x00\x00</code>,
soit 512 en little endian. Nous pouvons extraire le fichier grâce à la commande <code>dd</code> suivante :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>dd <span style="color:#66d9ef">if</span><span style="color:#f92672">=</span>fs.packed bs<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span> skip<span style="color:#f92672">=</span><span style="color:#66d9ef">$((</span><span style="color:#ae81ff">0</span>x7771<span style="color:#66d9ef">))</span> count<span style="color:#f92672">=</span><span style="color:#ae81ff">512</span> | sha256sum 
</span></span></code></pre></div><p>On obtient alors le hash <code>8863d06f81bd19b9f540ef57fbd77c45d376b198b8f561192e3536ac0f82f963</code> et notre flag avec !</p>
<p>Pour ceux qui aimeraient examiner le système de fichiers par eux-mêmes, vous pouvez compiler le programme avec <code>make debug</code>
depuis le repository GitHub et utiliser la commande <code>unpack</code>.</p>
<ul class="pa0">
  
</ul>
<div class="mt6 instapaper_ignoref">
      
      
      </div>
    </div>

    <aside class="w-30-l mt6-l">




</aside>

  </article>

    </main>
    <footer class="bg-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 no-underline white-70 dn dib-ns pv2 ph3" >
    &copy;  2025  Jeanne d'Hack CTF. Tous droits réservés. 
  </a>
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="/legal/" >
      Mentions légales
  </a>
  </div>
</footer>

  </body>
</html>
